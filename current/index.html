<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="description" content="Master System Design for the Common Architecture">
<meta name="keywords" content="common architecture master system design">
<meta name="author" content="TVUK System Team">
<title>Master System Design Document: EOEPCA.SDD.001</title>
<link rel="stylesheet" href="stylesheets/eoepca.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Master System Design Document: EOEPCA.SDD.001</h1>
<div class="details">
<span id="author" class="author">TVUK System Team</span><br>
<span id="email" class="email">&lt;<a href="mailto:Eoepca.SystemTeam@telespazio.com">Eoepca.SystemTeam@telespazio.com</a>&gt;</span><br>
<span id="revnumber">version Draft for 1.1,</span>
<span id="revdate">In Progress</span>
<br><span id="revremark"></span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Master System Design</div>
<ul class="sectlevel1">
<li><a href="#_introduction">1. Introduction</a>
<ul class="sectlevel2">
<li><a href="#_purpose_and_scope">1.1. Purpose and Scope</a></li>
<li><a href="#_structure_of_the_document">1.2. Structure of the Document</a></li>
<li><a href="#_reference_documents">1.3. Reference Documents</a></li>
<li><a href="#_terminology">1.4. Terminology</a></li>
<li><a href="#_glossary">1.5. Glossary</a></li>
</ul>
</li>
<li><a href="#mainContext">2. Context</a></li>
<li><a href="#mainDesignOverview">3. Design Overview</a>
<ul class="sectlevel2">
<li><a href="#_domain_areas">3.1. Domain Areas</a>
<ul class="sectlevel3">
<li><a href="#_user_management">3.1.1. User Management</a></li>
<li><a href="#_processing_and_chaining">3.1.2. Processing and Chaining</a></li>
<li><a href="#_resource_management">3.1.3. Resource Management</a></li>
<li><a href="#_platform_api">3.1.4. Platform API</a></li>
<li><a href="#_web_portal">3.1.5. Web Portal</a></li>
</ul>
</li>
<li><a href="#_architecture_layers">3.2. Architecture Layers</a></li>
</ul>
</li>
<li><a href="#mainUserManagement">4. User Management</a>
<ul class="sectlevel2">
<li><a href="#IAM">4.1. Identity and Access Management (IAM)</a>
<ul class="sectlevel3">
<li><a href="#_iam_approach">4.1.1. IAM Approach</a></li>
<li><a href="#_iam_top_level_interfaces">4.1.2. IAM Top-level Interfaces</a></li>
</ul>
</li>
<li><a href="#mainAuthenticatedIdentity">4.2. Authenticated Identity</a>
<ul class="sectlevel3">
<li><a href="#_overview">4.2.1. Overview</a></li>
<li><a href="#mainLoginService">4.2.2. Login Service</a></li>
<li><a href="#_oidc_id_token">4.2.3. OIDC ID Token</a></li>
<li><a href="#_oidc_clients">4.2.4. OIDC Clients</a></li>
<li><a href="#_pep_resource_server_filter">4.2.5. PEP (Resource Server filter)</a></li>
<li><a href="#_access_token_validation">4.2.6. Access Token Validation</a></li>
<li><a href="#_federated_user_access">4.2.7. Federated User Access</a>
<ul class="sectlevel4">
<li><a href="#_user_pre_authorization">4.2.7.1. User Pre-authorization</a></li>
<li><a href="#_possible_use_of_oidc_jwks_federation">4.2.7.2. Possible use of OIDC JWKS Federation</a></li>
</ul>
</li>
<li><a href="#_additional_oidc_capabilities">4.2.8. Additional OIDC Capabilities</a>
<ul class="sectlevel4">
<li><a href="#_oidc_discovery">4.2.8.1. OIDC Discovery</a></li>
<li><a href="#_client_registration">4.2.8.2. Client Registration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_authorization_policy_decision">4.3. Authorization (Policy Decision)</a>
<ul class="sectlevel3">
<li><a href="#_xacml_extensible_access_control_markup_language">4.3.1. XACML (eXtensible Access Control Markup Language)</a>
<ul class="sectlevel4">
<li><a href="#_xacml_3_0">4.3.1.1. XACML 3.0</a></li>
<li><a href="#_geoxacml">4.3.1.2. GeoXACML</a></li>
<li><a href="#_alfa_abbreviated_language_for_authorization">4.3.1.3. ALFA (Abbreviated Language For Authorization)</a></li>
<li><a href="#_xacml_related_technologies">4.3.1.4. XACML Related Technologies</a></li>
</ul>
</li>
<li><a href="#_uma_user_managed_access">4.3.2. UMA (User-Managed Access)</a>
<ul class="sectlevel4">
<li><a href="#_uma_main_actors">4.3.2.1. UMA Main Actors</a></li>
<li><a href="#_uma_phases">4.3.2.2. UMA Phases</a></li>
<li><a href="#_uma_terminology">4.3.2.3. UMA Terminology</a></li>
<li><a href="#_resource_protection">4.3.2.4. Resource Protection</a></li>
<li><a href="#_access_resource">4.3.2.5. Access Resource</a></li>
<li><a href="#_resource_server_register_permission">4.3.2.6. Resource Server Register Permission</a></li>
<li><a href="#_client_request_authorization">4.3.2.7. Client Request Authorization</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mainBilling">4.4. Accounting and Billing</a>
<ul class="sectlevel3">
<li><a href="#_billing_identities">4.4.1. Billing Identities</a></li>
<li><a href="#_billing_service">4.4.2. Billing Service</a></li>
<li><a href="#_pricing_engine">4.4.3. Pricing Engine</a></li>
<li><a href="#_commercially_licensed_resources">4.4.4. Commercially Licensed Resources</a></li>
<li><a href="#_budgets">4.4.5. Budgets</a></li>
<li><a href="#_inter_platform_payments">4.4.6. Inter-platform Payments</a>
<ul class="sectlevel4">
<li><a href="#_inter_platform_payment_model_and_process">4.4.6.1. Inter-platform Payment Model and Process</a></li>
</ul>
</li>
<li><a href="#_federated_commercial_services_without_inter_platform_payments_direct_payments">4.4.7. Federated Commercial Services Without Inter-platform Payments: Direct Payments</a></li>
<li><a href="#_estimating_inter_platform_costs">4.4.8. Estimating Inter-platform Costs</a></li>
<li><a href="#_relationship_to_system_components">4.4.9. Relationship to System Components</a></li>
<li><a href="#_payment_processing_systems">4.4.10. Payment Processing Systems</a></li>
</ul>
</li>
<li><a href="#_user_profile">4.5. User Profile</a>
<ul class="sectlevel3">
<li><a href="#_licence_and_tc_management">4.5.1. Licence and T&amp;C Management</a>
<ul class="sectlevel4">
<li><a href="#_licence_requirement_checks">4.5.1.1. Licence Requirement Checks</a></li>
<li><a href="#_licence_acquisition">4.5.1.2. Licence Acquisition</a></li>
<li><a href="#_licence_administration">4.5.1.3. Licence Administration</a></li>
<li><a href="#_porting_licences_within_the_federation">4.5.1.4. Porting Licences Within the Federation</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#mainProcessingAndChaining">5. Processing and Chaining</a>
<ul class="sectlevel2">
<li><a href="#_solution_overview">5.1. Solution Overview</a></li>
<li><a href="#procK8s">5.2. Resource Layer (Infrastructure) Interface</a></li>
<li><a href="#mainAppPackage">5.3. Application Packaging</a></li>
<li><a href="#mainProcEMS">5.4. Execution Management Service (EMS)</a></li>
<li><a href="#mainProcADES">5.5. Application Deployment and Execution Service (ADES)</a></li>
<li><a href="#procServiceDataAccess">5.6. Processing Service Data Access</a>
<ul class="sectlevel3">
<li><a href="#_user_authorization_context">5.6.1. User Authorization Context</a></li>
</ul>
</li>
<li><a href="#_wps_t_restjson">5.7. WPS-T REST/JSON</a></li>
<li><a href="#_interactive_graphical_applications">5.8. Interactive (Graphical) Applications</a></li>
<li><a href="#_parallel_processing">5.9. Parallel Processing</a></li>
<li><a href="#_processor_development_environment_pde">5.10. Processor Development Environment (PDE)</a></li>
<li><a href="#_interactive_analysis_tool">5.11. Interactive Analysis Tool</a></li>
</ul>
</li>
<li><a href="#mainResourceManagement">6. Resource Management</a>
<ul class="sectlevel2">
<li><a href="#mainResourceCatalogue">6.1. Resource Catalogue</a>
<ul class="sectlevel3">
<li><a href="#mainOpenSearch">6.1.1. CEOS OpenSearch Best Practise</a></li>
<li><a href="#mainAppCatalogue">6.1.2. Application Catalogue</a></li>
<li><a href="#mainDataCatalogue">6.1.3. Data Catalogue</a>
<ul class="sectlevel4">
<li><a href="#_metadata_organisation">6.1.3.1. Metadata Organisation</a></li>
<li><a href="#_example_usage_with_opensearch">6.1.3.2. Example Usage with OpenSearch</a></li>
<li><a href="#_data_access">6.1.3.3. Data Access</a></li>
<li><a href="#_catalogue_compositionaggregation">6.1.3.4. Catalogue Composition/Aggregation</a></li>
</ul>
</li>
<li><a href="#_federated_discovery">6.1.4. Federated Discovery</a></li>
</ul>
</li>
<li><a href="#_data_access_services">6.2. Data Access Services</a></li>
<li><a href="#mainDataAccessGateway">6.3. Data Access Gateway</a></li>
<li><a href="#mainDataAccessLib">6.4. Data Access Library (DAL)</a></li>
<li><a href="#_data_ingestion">6.5. Data Ingestion</a></li>
<li><a href="#mainWorkspace">6.6. Workspace</a></li>
</ul>
</li>
<li><a href="#mainPlatformApi">7. Platform API</a>
<ul class="sectlevel2">
<li><a href="#mainServiceApi">7.1. Service API</a>
<ul class="sectlevel3">
<li><a href="#platformCapabilities">7.1.1. Platform Capabilities</a></li>
<li><a href="#_authentication">7.1.2. authentication</a></li>
<li><a href="#_billing">7.1.3. billing</a></li>
<li><a href="#_data_search">7.1.4. data_search</a></li>
<li><a href="#_data_catalogue">7.1.5. data_catalogue</a></li>
<li><a href="#_app_search">7.1.6. app_search</a></li>
<li><a href="#_map">7.1.7. map</a></li>
<li><a href="#_tile">7.1.8. tile</a></li>
<li><a href="#_feature">7.1.9. feature</a></li>
<li><a href="#_coverage">7.1.10. coverage</a></li>
<li><a href="#_datacube">7.1.11. datacube</a></li>
<li><a href="#_object_store">7.1.12. object_store</a></li>
<li><a href="#_ems">7.1.13. ems</a></li>
<li><a href="#_ades">7.1.14. ades</a></li>
<li><a href="#_workspace">7.1.15. workspace</a></li>
</ul>
</li>
<li><a href="#mainClientLibrary">7.2. Client Library</a>
<ul class="sectlevel3">
<li><a href="#_client_library_concept_illustration">7.2.1. Client Library Concept Illustration</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#mainWebPortal">8. Web Portal</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>EO Exploitation Platform Common Architecture<br>
<em>Master System Design Document</em><br>
EOEPCA.SDD.001</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>COMMENTS and ISSUES</strong><br>
If you would like to raise comments or issues on this document, please do so by raising an Issue at the following URL <a href="https://github.com/EOEPCA/master-system-design/issues" target="_blank" rel="noopener">https://github.com/EOEPCA/master-system-design/issues</a>.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>PDF</strong><br>
This document is available in PDF format <a href="EOEPCA-master-system-design.pdf" target="_blank" rel="noopener">here</a>.</p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>EUROPEAN SPACE AGENCY CONTRACT REPORT</strong><br>
The work described in this report was done under ESA contract. Responsibility for the contents resides in the author or organisation that prepared it.</p></td>
<td class="tableblock halign-center valign-top"><p class="tableblock"><strong>TELESPAZIO VEGA UK Ltd</strong><br>
350 Capability Green, Luton, Bedfordshire, LU1 3LU, United Kingdom.<br>
Tel: +44 (0)1582 399000<br>
<a href="http://telespazio-vega.com/">www.telespazio-vega.com</a></p></td>
</tr>
</tbody>
</table>
<hr>
<div class="dlist">
<dl>
<dt class="hdlist1">AMENDMENT HISTORY</dt>
<dd>
<p>This document shall be amended by releasing a new edition of the document in its entirety.<br>
The Amendment Record Sheet below records the history and issue status of this document.</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. Amendment Record Sheet</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 25%;">
<col style="width: 62.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-top">ISSUE</th>
<th class="tableblock halign-center valign-top">DATE</th>
<th class="tableblock halign-left valign-top">REASON</th>
</tr>
</thead>
<tbody>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">1.1</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">InProgress</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Updates during development of Reference Implementation</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">1.0</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">02/08/2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Issue for domain expert ITT</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">0.6</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">18/07/2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added XACML description + PDF template modifications</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">0.5</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">09/07/2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added Client Library + Billing</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">0.4</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">21/06/2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added Platform API</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">0.3</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">13/05/2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Added content for Processing &amp; Chaining and Resource Management</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">0.2</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">25/04/2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Re-work IAM approach</p></td>
</tr>
<tr>
<th class="tableblock halign-center valign-top"><p class="tableblock">0.1</p></th>
<td class="tableblock halign-center valign-top"><p class="tableblock">24/04/2019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial in-progress draft</p></td>
</tr>
</tbody>
</table>
</dd>
</dl>
</div>
<hr>
<div style="page-break-after: always;"></div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="_introduction">1. Introduction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_purpose_and_scope">1.1. Purpose and Scope</h3>
<div class="paragraph">
<p>This document presents the Master System Design for the Common Architecture.</p>
</div>
</div>
<div class="sect2">
<h3 id="_structure_of_the_document">1.2. Structure of the Document</h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Section 2 - <a href="#mainContext">Context</a></dt>
<dd>
<p>Provides the context for Exploitation Platforms within the ecosystem of EO analysis.</p>
</dd>
<dt class="hdlist1">Section 3 - <a href="#mainDesignOverview">Design Overview</a></dt>
<dd>
<p>Provides an overview of the Common Architecture and the domain areas.</p>
</dd>
<dt class="hdlist1">Section 4 - <a href="#mainUserManagement">User Management</a></dt>
<dd>
<p>Describes the User Management domain area.</p>
</dd>
<dt class="hdlist1">Section 5 - <a href="#mainProcessingAndChaining">Processing and Chaining</a></dt>
<dd>
<p>Describes the Processing &amp; Chaining domain area.</p>
</dd>
<dt class="hdlist1">Section 6 - <a href="#mainResourceManagement">Resource Management</a></dt>
<dd>
<p>Describes the Resource Management domain area.</p>
</dd>
<dt class="hdlist1">Section 7 - <a href="#mainPlatformApi">Platform API</a></dt>
<dd>
<p>Describes the Platform API, covering all domain areas.</p>
</dd>
<dt class="hdlist1">Section 8 - <a href="#mainWebPortal">Web Portal</a></dt>
<dd>
<p>Describes the Web Portal, covering all domain areas.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="_reference_documents">1.3. Reference Documents</h3>
<div class="paragraph">
<p>The following is a list of Reference Documents with a direct bearing on the content of this document.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 18.1818%;">
<col style="width: 63.6363%;">
<col style="width: 18.1819%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Reference</th>
<th class="tableblock halign-left valign-top">Document Details</th>
<th class="tableblock halign-left valign-top">Version</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="EOEPCA-UC"></a>[EOEPCA-UC]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>EOEPCA - Use Case Analysis<br>
EOEPCA.TN.005<br>
<a href="https://eoepca.github.io/use-case-analysis" class="bare">https://eoepca.github.io/use-case-analysis</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Issue 1.0,<br>
02/08/2019</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="EP-FM"></a>[EP-FM]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Exploitation Platform - Functional Model,<br>
ESA-EOPSDP-TN-17-050</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Issue 1.0,<br>
30/11/2017</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="TEP-OA"></a>[TEP-OA]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Thematic Exploitation Platform Open Architecture,<br>
EMSS-EOPS-TN-17-002</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Issue 1,<br>
12/12/2017</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="WPS-T"></a>[WPS-T]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Testbed-14: WPS-T Engineering Report,<br>
OGC 18-036r1,<br>
<a href="http://docs.opengeospatial.org/per/18-036r1.html" class="bare">http://docs.opengeospatial.org/per/18-036r1.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>18-036r1,<br>
07/02/2019</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="WPS-REST-JSON"></a>[WPS-REST-JSON]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC WPS 2.0 REST/JSON Binding Extension, Draft,<br>
OGC 18-062,<br>
<a href="https://raw.githubusercontent.com/opengeospatial/wps-rest-binding/develop/docs/18-062.pdf" class="bare">https://raw.githubusercontent.com/opengeospatial/wps-rest-binding/develop/docs/18-062.pdf</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>1.0-draft</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="CWL"></a>[CWL]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Common Workflow Language Specifications,<br>
<a href="https://www.commonwl.org/v1.0/" class="bare">https://www.commonwl.org/v1.0/</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v1.0.2</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="TB13-AP"></a>[TB13-AP]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Testbed-13, EP Application Package Engineering Report,<br>
OGC 17-023,<br>
<a href="http://docs.opengeospatial.org/per/17-023.html" class="bare">http://docs.opengeospatial.org/per/17-023.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>17-023,<br>
30/01/2018</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="TB13-ADES"></a>[TB13-ADES]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Testbed-13, Application Deployment and Execution Service Engineering Report,<br>
OGC 17-024,<br>
<a href="http://docs.opengeospatial.org/per/17-024.html" class="bare">http://docs.opengeospatial.org/per/17-024.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>17-024,<br>
11/01/2018</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="TB14-AP"></a>[TB14-AP]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Testbed-14, Application Package Engineering Report,<br>
OGC 18-049r1,<br>
<a href="http://docs.opengeospatial.org/per/18-049r1.html" class="bare">http://docs.opengeospatial.org/per/18-049r1.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>18-049r1,<br>
07/02/2019</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="TB14-ADES"></a>[TB14-ADES]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Testbed-14, ADES &amp; EMS Results and Best Practices Engineering Report,<br>
OGC 18-050r1, <a href="http://docs.opengeospatial.org/per/18-050r1.html" class="bare">http://docs.opengeospatial.org/per/18-050r1.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>18-050r1,<br>
08/02/2019</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OS-GEO-TIME"></a>[OS-GEO-TIME]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OpenSearch GEO: OpenSearch Geo and Time Extensions,<br>
OGC 10-032r8,<br>
<a href="http://www.opengeospatial.org/standards/opensearchgeo" class="bare">http://www.opengeospatial.org/standards/opensearchgeo</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>10-032r8,<br>
14/04/2014</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OS-EO"></a>[OS-EO]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OpenSearch EO: OGC OpenSearch Extension for Earth Observation,<br>
OGC 13-026r9,<br>
<a href="http://docs.opengeospatial.org/is/13-026r8/13-026r8.html" class="bare">http://docs.opengeospatial.org/is/13-026r8/13-026r8.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>13-026r9,<br>
16/12/2016</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="GEOJSON-LD"></a>[GEOJSON-LD]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC EO Dataset Metadata GeoJSON(-LD) Encoding Standard,<br>
OGC 17-003r1/17-084</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>17-003r1/17-084</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="GEOJSON-LD-RESP"></a>[GEOJSON-LD-RESP]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC OpenSearch-EO GeoJSON(-LD) Response Encoding Standard,<br>
OGC 17-047</p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>17-047</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="PCI-DSS"></a>[PCI-DSS]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>The Payment Card Industry Data Security Standard,<br>
<a href="https://www.pcisecuritystandards.org/document_library?category=pcidss&amp;document=pci_dss" class="bare">https://www.pcisecuritystandards.org/document_library?category=pcidss&amp;document=pci_dss</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v3.2.1</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="CEOS-OS-BP"></a>[CEOS-OS-BP]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>CEOS OpenSearch Best Practise,<br>
<a href="http://ceos.org/ourwork/workinggroups/wgiss/access/opensearch/" class="bare">http://ceos.org/ourwork/workinggroups/wgiss/access/opensearch/</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v1.2,<br>
13/06/2017</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OIDC"></a>[OIDC]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OpenID Connect Core 1.0,<br>
<a href="https://openid.net/specs/openid-connect-core-1_0.html" class="bare">https://openid.net/specs/openid-connect-core-1_0.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v1.0,<br>
08/11/2014</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OGC-CSW"></a>[OGC-CSW]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Catalogue Services 3.0 Specification - HTTP Protocol Binding (Catalogue Services for the Web),<br>
OGC 12-176r7,<br>
<a href="http://docs.opengeospatial.org/is/12-176r7/12-176r7.html" class="bare">http://docs.opengeospatial.org/is/12-176r7/12-176r7.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v3.0,<br>
10/06/2016</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OGC-WMS"></a>[OGC-WMS]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Web Map Server Implementation Specification,<br>
OGC 06-042,<br>
<a href="http://portal.opengeospatial.org/files/?artifact_id=14416" class="bare">http://portal.opengeospatial.org/files/?artifact_id=14416</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v1.3.0,<br>
05/03/2006</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OGC-WMTS"></a>[OGC-WMTS]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Web Map Tile Service Implementation Standard,<br>
OGC 07-057r7,<br>
<a href="http://portal.opengeospatial.org/files/?artifact_id=35326" class="bare">http://portal.opengeospatial.org/files/?artifact_id=35326</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v1.0.0,<br>
06/04/2010</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OGC-WFS"></a>[OGC-WFS]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Web Feature Service 2.0 Interface Standard – With Corrigendum,<br>
OGC 09-025r2,<br>
<a href="http://docs.opengeospatial.org/is/09-025r2/09-025r2.html" class="bare">http://docs.opengeospatial.org/is/09-025r2/09-025r2.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v2.0.2,<br>
10/07/2014</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OGC-WCS"></a>[OGC-WCS]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>OGC Web Coverage Service (WCS) 2.1 Interface Standard - Core,<br>
OGC 17-089r1,<br>
<a href="http://docs.opengeospatial.org/is/17-089r1/17-089r1.html" class="bare">http://docs.opengeospatial.org/is/17-089r1/17-089r1.html</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v2.1,<br>
16/08/2018</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="OGC-WCPS"></a>[OGC-WCPS]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Web Coverage Processing Service (WCPS) Language Interface Standard,<br>
OGC 08-068r2,<br>
<a href="http://portal.opengeospatial.org/files/?artifact_id=32319" class="bare">http://portal.opengeospatial.org/files/?artifact_id=32319</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>v1.0.0,<br>
25/03/2009</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a id="AWS-S3"></a>[AWS-S3]</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Amazon Simple Storage Service REST API,<br>
<a href="https://docs.aws.amazon.com/AmazonS3/latest/API" class="bare">https://docs.aws.amazon.com/AmazonS3/latest/API</a></p>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>API Version 2006-03-01</p>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_terminology">1.4. Terminology</h3>
<div class="paragraph">
<p>The following terms are used in the Master System Design.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 75%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User with administrative capability on the EP</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Algorithm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A self-contained set of operations to be performed, typically to achieve a desired data manipulation. The algorithm must be implemented (codified) for deployment and execution on the platform.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Analysis Result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>Products</em> produced as output of an <em>Interactive Application</em> analysis session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Analytics</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of activities aimed to discover, interpret and communicate meaningful patters within the data. Analytics considered here are performed manually (or in a semi-automatic way) on-line with the aid of <em>Interactive Applications</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Artefact</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The 'software' component that provides the execution unit of the <em>Application Package</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Deployment and Execution Service (ADES)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">WPS-T (REST/JSON) service that incorporates the Docker execution engine, and is responsible for the execution of the processing service (as a WPS request) within the ‘target’ Exploitation Platform.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Descriptor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A file that provides the metadata part of the <em>Application Package</em>. Provides all the metadata required to accommodate the processor within the WPS service and make it available for execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Package</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A platform independent and self-contained representation of a software item, providing executable, metadata and dependencies such that it can be deployed to and executed within an Exploitation Platform. Comprises the <em>Application Descriptor</em> and the <em>Application Artefact</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bulk Processing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution of a <em>Processing Service</em> on large amounts of data specified by AOI and TOI.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The codification of an algorithm performed with a given programming language - compiled to Software or directly executed (interpretted) within the platform.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Compute Platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Platform on which execution occurs (this may differ from the Host or Home platform where federated processing is happening)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Consumer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User accessing existing services/products within the EP. Consumers may be scientific/research or commercial, and may or may not be experts of the domain</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Access Library</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An abstraction of the interface to the data layer of the resource tier. The library provides bindings for common languages (including python, Javascript) and presents a common object model to the code.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Development</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The act of building new products/services/applications to be exposed within the platform and made available for users to conduct exploitation activities. Development may be performed inside or outside of the platform. If performed outside, an integration activity will be required to accommodate the developed service so that it is exposed within the platform.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Discovery</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User finds products/services of interest to them based upon search criteria.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The act to start a <em>Processing Service</em> or an <em>Interactive Application</em>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution Management Service (EMS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The EMS is responsible for the orchestration of workflows, including the possibility of steps running on other (remote) platforms, and the on-demand deployment of processors to local/remote ADES as required.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expert</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User developing and integrating added-value to the EP (Scientific Researcher or Service Developer)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exploitation Tier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Exploitation Tier represents the end-users who exploit the services of the platform to perform analysis, or using high-level applications built-in on top of the platform’s services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">External Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An application or script that is developed and executed outside of the Exploitation Platform, but is able to use the data/services of the EP via a programmatic interface (API).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Guest</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An unregistered User or an unauthenticated Consumer with limited access to the EP&#8217;s services</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Home Platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Platform on which a User is based or from which an action was initiated by a User</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Host Platform</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Platform through which a Resource has been published</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity Provider (IdP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The source for validating user identity in a federated identity system, (user authentication as a service).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interactive Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A stand-alone application provided within the exploitation platform for on-line hosted processing. Provides an interactive interface through which the user is able to conduct their analysis of the data, producing <em>Analysis Results</em> as output. Interactive Applications include at least the following types: console application, web application (rich browser interface), remote desktop to a hosted VM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interactive Console Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A simple <em>Interactive Application</em> for analysis in which a console interface to a platform-hosted terminal is provided to the user. The console interface can be provided through the user&#8217;s browser session or through a remote SSH connection.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interactive Remote Desktop</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An Interactive Application for analysis provided as a remote desktop session to an OS-session (or directly to a 'native' application) on the exploitation platform. The user will have access to a number of applications within the hosted OS. The remote desktop session is provided through the user’s web browser.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interactive Web Application</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An Interactive Application for analysis provided as a rich user interface through the user&#8217;s web browser.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key-Value Pair</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A key-value pair (KVP) is an abstract data type that includes a group of key identifiers and a set of associated values. Key-value pairs are frequently used in lookup tables, hash tables and configuration files.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes (K8s)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Container orchestration system for automating application deployment, scaling and management.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Login Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An encapsulation of Authenticated Login provision within the Exploitation Platform context. The Login Service is an OpenID Connect Provider that is used purely for authentication. It acts as a Relying Party in flows with external IdPs to obtain access to the user&#8217;s identity.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Network of EO Resources</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The coordinated collection of European EO resources (platforms, data sources, etc.).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Object Store</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A computer data storage architecture that manages data as objects. Each object typically includes the data itself, a variable amount of metadata, and a globally unique identifier.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">On-demand Processing Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>Processing Service</em> whose execution is initiated directly by the user on an ad-hoc basis.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform (EP)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An on-line collection of products, services and tools for exploitation of EO data</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Platform Tier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Platform Tier represents the Exploitation Platform and the services it offers to end-users</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processing</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A set of pre-defined activities that interact to achieve a result. For the exploitation platform, comprises on-line processing to derive data products from input data, conducted by a hosted processing service execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processing Result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The <em>Products</em> produced as output of a <em>Processing Service</em> execution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processing Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A non-interactive data processing that has a well-defined set of input data types, input parameterisation, producing <em>Processing Results</em> with a well-defined output data type.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Products</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EO data (commercial and non-commercial) and Value-added products and made available through the EP. <em>It is assumed that the Hosting Environment for the EP makes available an existing supply of EO Data</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A entity, such as a Product, Processing Service or Interactive Application, which is of interest to a user, is indexed in a catalogue and can be returned as a single meaningful search result</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Resource Tier</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Resource Tier represents the hosting infrastructure and provides the EO data, storage and compute upon which the exploitation platform is deployed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Reusable Research Object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An encapsulation of some research/analysis that describes all aspects required to reproduce the analysis, including data used, processing performed etc.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Scientific Researcher</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expert user with the objective to perform scientific research. Having minimal IT knowledge with no desire to acquire it, they want the effort for the translation of their algorithm into a service/product to be minimised by the platform.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Service Developer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Expert user with the objective to provide a performing, stable and reliable service/product. Having deeper IT knowledge or a willingness to acquire it, they require deeper access to the platform IT functionalities for optimisation of their algorithm.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Software</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The compilation of code into a binary program to be executed within the platform on-line computing environment.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Systematic Processing Service</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A <em>Processing Service</em> whose execution is initiated automatically (on behalf of a user), either according to a schedule (routine) or triggered by an event (e.g. arrival of new data).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Terms &amp; Conditions (T&amp;Cs)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The obligations that the user agrees to abide by in regard of usage of products/services of the platform. T&amp;Cs are set by the provider of each product/service.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactional Web Processing Service (WPS-T)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactional extension to WPS that allows adhoc deployment / undeployment of user-provided processors.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">User</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An individual using the EP, of any type (Admin/Consumer/Expert/Guest)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value-added products</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Products generated from processing services of the EP (or external processing) and made available through the EP. This includes products uploaded to the EP by users and published for collaborative consumption</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Visualisation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">To obtain a visual representation of any data/products held within the platform - presented to the user within their web browser session.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Coverage Service (WCS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OGC standard that provides an open specification for sharing raster datasets on the web.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Coverage Processing Service (WCPS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OGC standard that defines a protocol-independent language for the extraction, processing, and analysis of multi-dimentional coverages representing sensor, image, or statistics data.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Feature Service (WFS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OGC standard that makes geographic feature data (vector geospatial datasets) available on the web.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Map Service (WMS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OGC standard that provides a simple HTTP interface for requesting geo-registered map images from one or more distributed geospatial databases.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Map Tile Service (WMTS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OGC standard that provides a simple HTTP interface for requesting map tiles of spatially referenced data using the images with predefined content, extent, and resolution.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Processing Services (WPS)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OGC standard that defines how a client can request the execution of a process, and how the output from the process is handled.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Workspace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A user-scoped 'container' in the EP, in which each user maintains their own links to resources (products and services) that have been collected by a user during their usage of the EP. The workspace acts as the hub for a user&#8217;s exploitation activities within the EP</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_glossary">1.5. Glossary</h3>
<div class="paragraph">
<p>The following acronyms and abbreviations have been used in this report.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 85.7143%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Term</th>
<th class="tableblock halign-left valign-top">Definition</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AAI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Authentication &amp; Authorization Infrastructure</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ABAC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Attribute Based Access Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ADES</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Deployment and Execution Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALFA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Abbreviated Language For Authorization</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">AOI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Area of Interest</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">API</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Application Programming Interface</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Content Management System</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">CWL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Common Workflow Language</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">DAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Data Access Library</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execution Management Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EO</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Earth Observation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">EP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Exploitation Platform</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">FUSE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filesystem in Userspace</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">GeoXACML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Geo-specific extension to the XACML Policy Language</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IAM</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity and Access Management</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">IdP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identity Provider</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">JSON</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JavaScript Object Notation</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">K8s</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Kubernetes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">KVP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Key-value Pair</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">M2M</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Machine-to-machine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">OGC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Open Geospatial Consortium</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Processor Development Environment</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PDP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy Decision Point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PEP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy Enforcement Point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">PIP</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Policy Information Point</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">RBAC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Role Based Access Control</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">REST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Representational State Transfer</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SSH</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Secure Shell</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">TOI</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Time of Interest</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">UMA</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User-Managed Access</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">VNC</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Virtual Network Computing</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WCS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Coverage Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WCPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Coverage Processing Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WFS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Feature Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WMS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Map Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WMTS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Map Tile Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WPS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Web Processing Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">WPS-T</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Transactional Web Processing Service</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">XACML</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">eXtensible Access Control Markup Language</p></td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mainContext">2. Context</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Master System Design provides an EO Exploitation Platform architecture that meets the service needs of current and future systems, as defined by the use cases described in <a href="#EOEPCA-UC">[EOEPCA-UC]</a>. These use cases must be explored under 'real world' conditions by engagement with existing deployments, initiatives, user groups, stakeholders and sponsors within the user community and within overlapping communities, in order to gain a fully representative understanding of the functional requirements.</p>
</div>
<div class="paragraph">
<p>The system design takes into consideration existing precursor architectures (such as the Exploitation Platform Functional Model <a href="#EP-FM">[EP-FM]</a> and Thematic Exploitation Platform Open Architecture <a href="#TEP-OA">[TEP-OA]</a>), including consideration of state-of-the-art technologies and approaches used by current related projects. The master system design describes functional blocks linked together by agreed standardised interfaces.</p>
</div>
<div class="paragraph">
<p>The importance of the OGC in these activities is recognised as a reference for the appropriate standards and in providing mechanisms to develop and evolve standards as required in the development of the architecture. In order to meet the design challenges we must apply the applicable existing OGC standards to the full set of federated use cases in order to expose deficiencies and identify needed evolution of the standards. Standards are equally important in all areas of the Exploitation Platform, including topics such as Authentication &amp; Authorization Infrastructure (AAI), containerisation and provisioning of virtual cloud resources to ensure portability of compute between different providers of resource layer.</p>
</div>
<div class="paragraph">
<p>Data and metadata are fundamental considerations for the creation of an architecture in order to ensure full semantic interoperability between services. In this regard, data modelling and the consideration of data standards are critical activities.</p>
</div>
<div class="paragraph">
<p>The system design must go beyond the provision of a standalone EO Exploitation Platform, by intrinsically supporting federation of similar EO platforms at appropriate levels of the service stack.  The Network of EO Resources seeks, ‘to unite the available - but scattered - European resources in a large federated and open environment’. In such a context, federation provides the potential to greatly enhance the utilization of data and services and provide as stimulus for research and commercial exploitation. From the end-user point of view, the federated system should present itself as a single consolidated environment in which all the federated resources are made available as an integrated system. Thus, the system design must specify federation-level interfaces that support this data and service-level interoperability in such a way that is seamless to the end users.</p>
</div>
<div class="paragraph">
<p>The goal is to create an Integrated Data Exploitation Environment. Users will apply their workflows close to the hosted data, supplemented by their own data. Processing outputs may be hosted as new products that can themselves contribute to the global catalogue. This paradigm can then be extended to encompass the federated set of Exploitation Platforms within the Network of EO Resources. The result is a Federated, Integrated Data Analysis Environment.</p>
</div>
<div class="paragraph">
<p>A Reference Implementation of the full architecture will be developed to prove the concepts and also to provide an off-the-shelf solution that can be instantiated by future projects to implement their EO Exploitation Platform, thus facilitating their ability to join the federated Network of EO Resources. <strong>Thus, the Reference Implementation can be regarded as a set of re-usable platform services, in the context of a re-usable platform architecture.</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect1">
<h2 id="mainDesignOverview">3. Design Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The overall system design has been considered by taking the ‘Exploitation Platform – Functional Model’ <a href="#EP-FM">[EP-FM]</a> as a starting point and then evolving these ideas in the context of existing interface standards (with some emphasis on the OGC protocol suite) and the need for federated services.</p>
</div>
<div class="sect2">
<h3 id="_domain_areas">3.1. Domain Areas</h3>
<div class="paragraph">
<p>The system architecture is designed to meet the use cases as defined in <a href="#EOEPCA-UC">[EOEPCA-UC]</a> and <a href="#EP-FM">[EP-FM]</a>. <a href="#EOEPCA-UC">[EOEPCA-UC]</a> makes a high-level analysis of the use-cases to identify the main system functionalities organised into domain areas: 'User Management', 'Processing &amp; Chaining' and 'Resource Management'. The high-level functionalities are often met by more than one domain area, and User Management (specifically Identity &amp; Access Management) cuts across all use cases, and forms the basis of all access control restrictions that are applied to platform services and data.</p>
</div>
<div class="paragraph">
<p><a href="#img_topLevelArchitecture">Figure 1</a> depicts the domain areas as top level component blocks in a Platform ‘A’. The arrows may be read as “uses”, each implying one or more service interfaces.</p>
</div>
<div id="img_topLevelArchitecture" class="imageblock text-center">
<div class="content">
<img src="./images/top-level-architecture.png" alt="top level architecture" width="70%">
</div>
<div class="title">Figure 1. Top-level Architecture</div>
</div>
<div class="paragraph">
<p>A potential federation concept is represented by interactions between corresponding blocks in a collaborating Platform ‘B’. The architecture aims to minimise dependencies and is conducive to the principle of subcontracting the implementation to experts in the respective domains. The web portal integrates various client components to form a rich user-facing interface. <strong>The Web Portal is depicted as it has interfaces with the other domain areas - but it is not a priority concern for the Common Architecture. Each exploitation platform would be expected to develop its own web interfaces according to its needs.</strong></p>
</div>
<div class="sect3">
<h4 id="_user_management">3.1.1. User Management</h4>
<div class="paragraph">
<p><em>Responsible for all aspects related to user identity, authentication, authorization, accounting and billing in a federated system-of-systems environment.</em></p>
</div>
<div class="paragraph">
<p>It provides authentication, authorization and accounting services that are required to access other elements of the architecture, including the processing-oriented services and resource-oriented services. Individual resources may have an associated access and/or charging policy, but these have to be checked against the identity of the user. Resource consumption may also be controlled e.g. by credits and/or quotas associated with the user account. In the Network of EO Resources, a user should not need to create an account on multiple platforms. Therefore some interactions will be required between the User Management functions, whether directly or in directly via trusted third party.</p>
</div>
</div>
<div class="sect3">
<h4 id="_processing_and_chaining">3.1.2. Processing and Chaining</h4>
<div class="paragraph">
<p><em>Provides access to a variety of processing functions, tools and applications, as well as execution environments in which to deploy them.</em></p>
</div>
<div class="paragraph">
<p>Provides a deployment and execution environment for processing tasks, analysis tools and interactive applications. Supports the chaining of processing tasks in workflows whose execution can include steps executed external to the origin exploitation platform. Handles and abstracts the low-level complexities of the different underlying compute technologies, and ensures the compute layer is scaled in accordance with current demand. Provides an integrated development environment to facilitate development of new processing algorithms and applications. Facilitating the network of EO resources by providing a federated interface to other processing services within the wider EO network.</p>
</div>
<div class="paragraph">
<p>The development and analysis environment provides a platform for the expert user to develop their own processing chains, experiments and workflows. It integrates with platform catalogue services (for data, processing services and applications) for discovery of available published datasets and processing elements. Subject to appropriate controls and permissions, the user can publish their own processing services and results. Workflows can be executed within the context of the processing facility, with the possibility to execute steps ‘remotely’ in collaborating platforms, with the results being collected for the continuation of the workflow.</p>
</div>
</div>
<div class="sect3">
<h4 id="_resource_management">3.1.3. Resource Management</h4>
<div class="paragraph">
<p><em>Responsible for maintaining an inventory of platform and federated resources, and providing services for data access and visualisation.</em></p>
</div>
<div class="paragraph">
<p>Storage and cataloguing of all persistent resources. First and foremost, this will contain multidimensional geo-spatial datasets. In addition it may include a variety of heterogeneous data and other resources, such as documentation, Docker images, processing workflows, etc. Handles and abstracts the low-level complexities of different underlying storage technologies and strategies. Facilitating the network of EO resources by providing a federated interface to other data services within the wider EO network.</p>
</div>
<div class="paragraph">
<p>The catalogue holds corresponding metadata for every published resource item in the local platform storage, as well as entries for resources that are located on remote collaborating platforms. Catalogue search and data access is provided through a range of standard interfaces, which are used by the local Web Portal and Processing &amp; Chaining elements and may be exposed externally as web services.</p>
</div>
<div class="paragraph">
<p>Access to services and resources is controlled according to an associated authorization policy as defined by the IAM approach. This component may interact with corresponding peer components on other platforms - for example to synchronise catalogue entries.</p>
</div>
<div class="paragraph">
<p>The user has a personal workspace in which to upload files, organise links to resources of interest (services/application/data), and receive/manage results output from processing executions. Shared workspaces for collaboration can be similarly provisioned. The ingestion of new data is controlled to ensure the quality of any published resource, including associated metadata, and to maintain the integrity of the catalogue.</p>
</div>
</div>
<div class="sect3">
<h4 id="_platform_api">3.1.4. Platform API</h4>
<div class="paragraph">
<p><em>Defines standard interfaces at both service and programmatic levels.</em></p>
</div>
<div class="paragraph">
<p>The Service API and its associated Client Library together present a standard platform interface against which analysis and exploitation activities may be developed, and through which platform services can be federated. The Platform API encourages interoperation between platforms and provides a consistent and portable programming paradigm for expert users.</p>
</div>
</div>
<div class="sect3">
<h4 id="_web_portal">3.1.5. Web Portal</h4>
<div class="paragraph">
<p><em>Presents the platform user interface for interacting with the local resources and processing facilities, as well as the wider network of EO resources.</em></p>
</div>
<div class="paragraph">
<p>The Web Portal provides the user interface (themed and branded according to the owning organisation) through which the user discovers the data/services available within the platform, and the analysis environment through which they can exploit these resources. It provides a rich, interactive web interface for discovering and working with all kinds of resources, including EO data, processing and documentation. It includes web service clients for smart search and data visualisations. It provides a workspace for developing and deploying processing algorithms, workflows, experiments and applications, and publishing results. It includes support and collaboration tools for the community.</p>
</div>
<div class="paragraph">
<p>Web Portal integrates together various web service clients that uses services provided by the specialist domains (Processing, Resource, User) on the local platform and collaborating platforms.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="sect2">
<h3 id="_architecture_layers">3.2. Architecture Layers</h3>
<div class="paragraph">
<p><a href="#img_architectureLayers">Figure 2</a> provides a simplified architectural view that illustrates the broad architecture layes of the Exploitation Platform, presented in the context of the infrastructure in which it is hosted and the end-users performing exploitation activities.</p>
</div>
<div id="img_architectureLayers" class="imageblock text-center">
<div class="content">
<img src="./images/architecture-layers.png" alt="architecture layers" width="80%">
</div>
<div class="title">Figure 2. Architecture Layers</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Resource Tier</dt>
<dd>
<p>The Resource Tier represents the hosting infrastructure and provides the EO data, storage and compute upon which the exploitation platform is deployed.</p>
</dd>
<dt class="hdlist1">Platform Tier</dt>
<dd>
<p>The Platform Tier represents the Exploitation Platform and the services it offers to end-users. The layers comprising the Platform Tier are further described below.</p>
</dd>
<dt class="hdlist1">Exploitation Tier</dt>
<dd>
<p>The Exploitation Tier represents the end-users who exploit the services of the platform to perform analysis, or using high-level applications built-in on top of the platform&#8217;s services.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The Exploitation Platform builds upon the services provided by the hosting infrastructure - specifically accessing its data holding and using its compute resources. The components providing the EP services are deployed within the compute offering, with additional compute resources being provisioned on-demand to support end-user analysis activities.</p>
</div>
<div class="paragraph">
<p>The EP&#8217;s services access the data resources through a Data Access Gateway that provides an abstraction of the data access interface provided by the resource tier. This abstraction provides a 'standard' data access semantic that can be relied upon by other EP services - thus isolating specific data access concerns of the resource tier to a single EP component.</p>
</div>
<div class="paragraph">
<p>The Processing Framework provides the environment through which processing services and applications are executed in support of end-user analysis activities. It might be envisaged that some built-in (common) processing functions are provided, but the main focus of the processing framework is to support deployment and execution of bespoke end-user processing algorithms, and interactive analysis. Access to the underlying data from the executing processes is marshalled through the Data Access Gateway and its supporting Data Access Library.</p>
</div>
<div class="paragraph">
<p>The EP provides Catalogue services, so that end-users can discover and browse the resources available in the platform and its federated partners. Thus, end-users can discover available processing services and applications, and search for data available for inclusion in their analysis.</p>
</div>
<div class="paragraph">
<p>Data Services based upon open standards serve the clients of the Exploitation Platform for data access and data visualisation. Access to the underlying data is made via the Data Access Gateway.</p>
</div>
<div class="paragraph">
<p>The Service API represents the public service interfaces exposed by the Exploitation Platform for consumption by its clients. Covering all aspects of the EP (authentication, data/processing discovery, processing etc.), these interfaces are based upon open standards and are designed to offer a consistent EP service access semantic within the network of EO resources. Use of the network (HTTP) interfaces of the Service API is facilitated by the Client Library that provides bindings for common languages (Python, R, Javascript). The Client Library is a programmatic representation of the Service API which acts as an abstraction of the Exploitation Platform and so facilitates the development of portable client implementations.</p>
</div>
<div class="paragraph">
<p>The Exploitation Tier hosts the web clients with which the end-user interacts to conduct their analysis/exploitation activities. These clients would typically utilise the Client Library in their implementation. The Web IDE is an interactive web application that Experts use to perform interactive research and to develop algorithms. The Command-line Client builds upon the Client Library to provide a command-line tool that can be used, for example, to automate EP interactions through scripts.</p>
</div>
<div class="paragraph">
<p>The Web Portal provides the main user interface for the Exploitation Platform. It would be expected that each platform would provide its own bespoke portal implementation, and so is beyond the scope of the Common Architecture. Nevertheless, the architecture and its service interface must meet the needs anticipated by future exploitation platform implementations. Similarly, the External Application represents web applications (external to the hosting environment of the exploitation platform) that use the services of the EP via its Service API and Client Library.</p>
</div>
<div class="paragraph">
<p>All user interactions with the services of the EP are executed within the context of a given user and their rights to access resources, with associated resource usage billing. Thus, the Identity and Access Management component covers all tiers in this layered model.</p>
</div>
<div class="paragraph">
<p>The focus of this design document is the Platform Tier, which is elaborated in subsequent sections of the document:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Section <a href="#mainUserManagement">User Management</a></dt>
<dd>
<p>This section adresses the main concerns of User Management which are user identity, access to resources and billing for resource usage.</p>
</dd>
<dt class="hdlist1">Section <a href="#mainProcessingAndChaining">Processing and Chaining</a></dt>
<dd>
<p>This section covers application packaging and the Processing Framework through which services/applications can be deployed in federated workflows.</p>
</dd>
<dt class="hdlist1">Section <a href="#mainResourceManagement">Resource Management</a></dt>
<dd>
<p>This section covers resource discovery through catalogues that act as a marketplace for data, services and applications. Resource Management ensures data is accessible through standard interfaces that serve the processing framework, and public data services to visualise and consume platform data.</p>
</dd>
<dt class="hdlist1">Section <a href="#mainPlatformApi">Platform API</a></dt>
<dd>
<p>This section provides a consolidated decription of the service interface of the EP and its associated client library, which together present a standard platform interface against which analysis and exploitation activities may be developed, and through which platform services can be federated.</p>
</dd>
</dl>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mainUserManagement">4. User Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In the context of the Common Architecture, User Management covers the following main functional areas:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Identity and Access Management (IAM)</dt>
<dd>
<p>Identification/authentication of users and authorization of access to protected resources (data/services) within the EP.</p>
</dd>
<dt class="hdlist1">Accounting and Billing</dt>
<dd>
<p>Maintaining an accounting record of all user accesses to data/compute/services/applications, supported by appropriate systems of credits and billing.</p>
</dd>
<dt class="hdlist1">User Profile</dt>
<dd>
<p>Maintenance of details associated to the user that may be needed in support of access management and billing.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>These are explored in the following sub-sections.</p>
</div>
<div class="sect2">
<h3 id="IAM">4.1. Identity and Access Management (IAM)</h3>
<div class="paragraph">
<p>The solution for IAM is driven by the need for Federated Identity and Authorization in the context of a network of collaborating exploitation platforms and connected services. This federated environment should facilitate an end-user experience in which they can use a single identity across collaborating platforms <strong>(Single Sign-On)</strong>, they can bring their own existing identity to the platforms <strong>('Login With' service)</strong>, and platforms can access the federated services of other platforms on behalf of the end-user <strong>(delegated access and authorization)</strong>.</p>
</div>
<div class="paragraph">
<p>The goal of IAM is to uniquely identify the user and limit access to protected resources to those having suitable access rights. We assume an Attribute Based Access Control (ABAC) approach in which authorization decisions are made based upon access policies/rules that define attributes required by resources and possessed (as claims) by users. ABAC is is seen as a more flexible approach than Role Base Access Control (RBAC), affording the ability to express more sophisticated authorizations rules beyond the role(s) of the user - and noting the fact that a role-based ruleset could be implemented within an attribute based approach, (i.e. RBAC is a subset/specialisation of ABAC).</p>
</div>
<div class="paragraph">
<p>In achieving this there are three main concerns:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Unique user identification</p>
</li>
<li>
<p>Determine the access policy applicable to the resource</p>
</li>
<li>
<p>From the access policy determine:</p>
<div class="ulist">
<ul>
<li>
<p>what attributes are required to access the protected resource</p>
</li>
<li>
<p>whether the user has the required attributes</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>For the Common Architecture, we establish separation of User Identification from Access Management. User identity is federated and handled external to the platform. Within the Network of EO Resources, resources held within an exploitation platform are made available to federated partner platforms. Authorization policy is enforced within the platform at point of access, but the access policy can be federated within the network of EO resources, leading to a system of <em>federated authorization</em>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The identity is provided externally. The external IdP has no association to the exploitation platform, and hence is not the appropriate place to administer attributes that relate to EP resources</p>
</li>
<li>
<p>The protected resources are under the custodianship of the exploitation platform and hence the exploitation platform enforces the access policy decision</p>
</li>
<li>
<p>The administrative domain for an access policy should should not be tied to an exploitation platform, which facilitates the provision of federation and virtual organisations</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Federation of services between exploitation platforms is an important goal of the Common Architecture. Thus, the IAM design must offer an approach through which user access is managed between platforms, ensuring proper enforcement of access controls and billing.</p>
</div>
<div class="sect3">
<h4 id="_iam_approach">4.1.1. IAM Approach</h4>
<div class="paragraph">
<p><a href="#img_iamOverview">Figure 3</a> presents the basic approach. At this stage it does not consider the case in which an exploitation platform accesses resources in another platform on behalf of a user, (for example a workflow step that is invoked on another platform). This is addressed in a later section. Users are authenticated by redirection to an external identity provider, (their ‘home’ IdP). This returns the authentication decision and some basic user information as required (such as name, email, etc.).</p>
</div>
<div id="img_iamOverview" class="imageblock text-center">
<div class="content">
<img src="./images/iam-overview.png" alt="iam overview" width="100%">
</div>
<div class="title">Figure 3. Identity and Access Management Overview</div>
</div>
<div class="paragraph">
<p>Each protected resource is fronted by its Policy Enforcement Point (PEP), which acts as filter that will only permit access if the appropriate conditions are met. This decision is made according to a set of rules that are under the control of and configured within the exploitation platform.</p>
</div>
<div class="paragraph">
<p>The Login Service is provided as a common component that is utilised by each PEP to perform the authentication flow with the external IdPs. In the case of an unauthenticated request that requires authentication, the PEP will initiate the Login Service by redirection of the User’s originating request. The successful flow ultimately redirects back to the PEP and so maintains the direct connection between the end-user agent and the resource server. An alternative approach would be the use of an API Gateway to perform the role of the PEP, acting as an intermediary between the end-user agent and the resource server. However, this would have the effect of proxying the connection which can have an impact on data transfer performance, which is of particular importance in the case of significant data volumes being returned to the User.</p>
</div>
<div class="paragraph">
<p>The PEP interrogates the PDP for an authorization decision. The PEP sends a request that indicates the pertinent details of the attempted access, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Identity of end-user (subject)</p>
</li>
<li>
<p>The API (path/version etc.) being accessed (resource)</p>
</li>
<li>
<p>The operation (HTTP verb) being performed (action)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Policy Decision Point (PDP) returns an authorization decision based upon details provided in the request, and the applicable authorization policy. The authorization policy may delegate all or part of the decision to external PDP(s) within the federated network. This represents a Federated Authorization model and facilitates a model of shared resources and virtual organisations.</p>
</div>
<div class="paragraph">
<p>The authorization policy defines a set of rules and how they should be evaluated to determine the policy decision. The rules are expressed through attributes. The policy is evaluated to determine what attributes are required, and what attributes the user possesses. This evaluation extends through external PDPs according to any federated authorization defined in the policy.</p>
</div>
<div class="paragraph">
<p>It should be additionally noted that the decision to allow the user access depends upon dynamic 'attributes', such as whether the user has enough credits to 'pay' for their usage, or whether they have accepted the necessary Terms &amp; Conditions for a given dataset or service. Thus, the PDP must interrogate other EP-services such as 'Accounting &amp; Billing' and 'User Profile' to answer such questions.</p>
</div>
<div class="paragraph">
<p><a href="#img_iamOverviewFlow">Figure 4</a> provides an overview of the IAM Flow, (success case).</p>
</div>
<div id="img_iamOverviewFlow" class="imageblock text-center">
<div class="content">
<img src="./images/iam-overview-flow.png" alt="iam overview flow" width="100%">
</div>
<div class="title">Figure 4. IAM Overview Flow</div>
</div>
<div class="paragraph">
<p><strong>Flows marked &lt;&lt;redirect&gt;&gt; should be interpreted as flows between services that are made by redirection through the User Agent.</strong> For brevity, the interface between the Login Service, the User Agent and the External IdPs is simplified in <a href="#img_iamOverviewFlow">Figure 4</a> - they are expanded in section <a href="#mainAuthenticatedIdentity">Authenticated Identity</a>. It should also be noted that the flows with the External IdP will vary according to the protocol required by the External IdP, (e.g. OAuth, SAML, etc.).</p>
</div>
</div>
<div class="sect3">
<h4 id="_iam_top_level_interfaces">4.1.2. IAM Top-level Interfaces</h4>
<div class="paragraph">
<p><a href="#img_iamInterfaces">Figure 5</a> illustrates the interfaces of the IAM architecture.</p>
</div>
<div id="img_iamInterfaces" class="imageblock text-center">
<div class="content">
<img src="./images/iam-interfaces.png" alt="iam interfaces" width="807" height="679">
</div>
<div class="title">Figure 5. IAM Interfaces</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">User Agent &#8594; PEP</dt>
<dd>
<p>The PEP acts as a HTTP filter on the access request to the API of the Protected Resource. The PEP intercepts the incoming request in order to enforce the authorization policy decision.</p>
</dd>
<dt class="hdlist1">PEP &#8594; Protected Resource</dt>
<dd>
<p>The Protected Resource exposes a public API for user consumption. The user&#8217;s access to the protected resource is only granted once the request has passed the authorization decision, which may or may not require user authentication.</p>
</dd>
<dt class="hdlist1">PEP &#8594; Login Service</dt>
<dd>
<p>The PEP uses a redirect to delegate the authentication flow to the Login Service.</p>
</dd>
<dt class="hdlist1">Login Service &#8594; User Agent &#8594; External IdP</dt>
<dd>
<p>The Login Service and External IdP interface via redirects through the User Agent. In order to support multiple external identity suppliers, the Login Service must act as a client to multiple external IdPs, and so must establish individual trust relationships with each of these. Alternatively, the Login Service can instead interface to a single external IdP Proxy, that interfaces to the external IdPs on behalf of the EP. The IdP Proxy can provide this service to multiple EPs.</p>
</dd>
<dt class="hdlist1">PEP &#8594; PDP</dt>
<dd>
<p>The PEP defers to the PDP to establish the authorization status of the incoming access attempt.<br>
The request to the PDP carries the user identification, the URI of the resource, and the action requested.<br>
The PDP-response returns the authorization decision.</p>
</dd>
<dt class="hdlist1">PDP &#8594; Other PDP</dt>
<dd>
<p>This interface represents federated authorization.<br>
It has the same interface characteristics as PEP&#8594;PDP.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mainAuthenticatedIdentity">4.2. Authenticated Identity</h3>
<div class="paragraph">
<p>The approach to user identity and authentication centres around the use of OpenID Connect. Each Exploitation Platform maintains their own OIDC Provider through which tokens can be issued to permit access to protected resources within the EP. The authentication itself is delegated to external Identity Providers at the preference of the end-user wishing to reuse their existing identity provision.</p>
</div>
<div class="sect3">
<h4 id="_overview">4.2.1. Overview</h4>
<div class="paragraph">
<p>The Login Service is an OpenID Connect Provider that provides a ‘Login With’ service that allows the platform to support multiple external identity providers. The Login Service acts as a Relying Party in its interactions with the external IdPs to establish the authenticated identity of the user through delegated authentication.</p>
</div>
<div class="paragraph">
<p>The Login Service presents an OIDC Provider interface to its clients, through which the OIDC clients can obtain Access Tokens to resources. The access tokens are presented by the clients in their requests to resource servers (intercepted by PEP). The PEP (acting on behalf of the resource server) relies upon the access token to establish the authenticated identity of the users making the requests. Once the user identity is established, then the PEP can continue with its policy decision (deferred to the PDP).</p>
</div>
<div class="paragraph">
<p>Thus, clients of the EP must act as OIDC Clients in order to authenticate their users to the platform, before invoking its services. Clients include the web applications that provide the UI of the exploitation platform, as well as other external applications/systems (including other exploitation platforms) wishing to use the services of the EP.</p>
</div>
<div class="paragraph">
<p>The Login Service must act as client (Relying Party) to each of the External IdPs to be supported and offered as a ‘Login With’ option. The interface/flow with the External IdP is integrated into the OIDC flow implemented by the Login Service. This includes prompting the user to discover their ‘home’ Identity provider. The interactions with the external IdP represents the ‘user authentication step’ within the OIDC flows. Completion of a successful authentication with the external IdP allows the Login Service to issue the requested access tokens (depending on the flow used).</p>
</div>
<div class="paragraph">
<p><a href="#img_iamAuthenticationFlow">Figure 6</a> illustrates the basic user access flow, invoked through a web browser.</p>
</div>
<div id="img_iamAuthenticationFlow" class="imageblock text-center">
<div class="content">
<img src="./images/iam-authentication-flow.png" alt="iam authentication flow" width="100%">
</div>
<div class="title">Figure 6. IAM Authentication Flow (Browser)</div>
</div>
</div>
<div class="sect3">
<h4 id="mainLoginService">4.2.2. Login Service</h4>
<div class="paragraph">
<p>The Login Service is an OIDC Provider that provides a ‘Login With’ service that allows the end-user to select their Identity Provider for purposes of authentication.</p>
</div>
<div class="paragraph">
<p>The Login Service is designed to support the onward forwarding of the authentication request through external identity services, which should be expected to include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>EduGain</p>
</li>
<li>
<p>GitHub</p>
</li>
<li>
<p>Google</p>
</li>
<li>
<p>Twitter</p>
</li>
<li>
<p>Facebook</p>
</li>
<li>
<p>LinkedIn</p>
</li>
<li>
<p>Others (to be defined)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Login Service must establish itself as a client (Relying Party) of all supported external IdPs, with appropriate trust relationships and support for their authentication flows.</p>
</div>
<div class="paragraph">
<p>The primary endpoints required to support the OIDC flows are as follows (these endpoints are taken, by example, from OKTA OIDC discovery metadata, <a href="https://micah.okta.com/oauth2/aus2yrcz7aMrmDAKZ1t7/.well-known/openid-configuration" class="bare">https://micah.okta.com/oauth2/aus2yrcz7aMrmDAKZ1t7/.well-known/openid-configuration</a>):</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">authorization_endpoint (/authorize)</dt>
<dd>
<p>To initiate the authentication, and to return the access tokens / code grant (depending on flow).</p>
</dd>
<dt class="hdlist1">token_endpoint (/token)</dt>
<dd>
<p>To exchange the code grant for the access tokens.</p>
</dd>
<dt class="hdlist1">userinfo_endpoint (/userinfo)</dt>
<dd>
<p>To obtain the user information ID token in accordance with the scopes requested in the authorization request.</p>
</dd>
<dt class="hdlist1">jwks_uri (/keys)</dt>
<dd>
<p>To obtain signing keys for Token validation purposes.</p>
</dd>
<dt class="hdlist1">end_session_endpoint (/logout)</dt>
<dd>
<p>To logout the user from the Login Service, i.e. clear session cookies etc. Although, given that the actual IdP is externalised from the Login Service, it would remain the case that any session cookies maintained by the external IdP would still be in place for a future authentication flow.</p>
</dd>
<dt class="hdlist1">introspection_endpoint (/introspect)</dt>
<dd>
<p>Used by clients to verify access tokens.</p>
</dd>
<dt class="hdlist1">revocation_endpoint (/revoke)</dt>
<dd>
<p>Used for (refresh) token revocation.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As described in section ‘Discovery’, the following endpoints relate to Discovery:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">OIDC Discovery (/.well-known/openid-configuration)</dt>
<dd>
<p>Dynamic discovery of OIDC endpoints by clients.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As described in section ‘Client Registration’, the following endpoints relate to Dynamic Client Registration:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">registration_endpoint (/clients)</dt>
<dd>
<p>Dynamic registration of clients (Authentication Agents).</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>As described in section ‘Federation’, the following endpoints relate to the establishment of a federation of collaborating Exploitation Platforms through a dynamic trust model:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">/.well-known/openid-federation</dt>
<dd>
<p>OIDC Federation API endpoint through which Entity Statements are published about itself and other entities (such as other Exploitation Platforms). See section ‘Federation’.</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_oidc_id_token">4.2.3. OIDC ID Token</h4>
<div class="paragraph">
<p>The ID Token is a JWT that is returned to from the /userinfo endpoint of the Login Service. The returned OIDC ID Token has been signed (JWS) by the Login Service and thus results in a token that asserts a user’s authenticated identity with integrity, and non-repudiation.</p>
</div>
</div>
<div class="sect3">
<h4 id="_oidc_clients">4.2.4. OIDC Clients</h4>
<div class="paragraph">
<p>Clients are Relying Parties that act on behalf of users accessing the services of the Exploitation Platform. They will either pre-emptively obtain their access token for required resources, or will attempt resource access and be redirected by exception to the OIDC Provider authentication flow.</p>
</div>
<div class="paragraph">
<p>In the case of a web application (browser hosted), the Implicit Flow would be used. In other cases, where possible, the Authorization Code Flow would be preferred.</p>
</div>
<div class="paragraph">
<p>The OIDC flows are initiated with the appropriate response_type (‘id_token token’ for Implicit Flow, ‘code’ for Authorization Code Flow) and scope of ‘oidc profile’.</p>
</div>
<div class="paragraph">
<p>At the successful conclusion of the flow the client receives the Access Token and ID Token. The Access Token is then used by the client as a Bearer token in its subsequent calls to access the EP resources.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pep_resource_server_filter">4.2.5. PEP (Resource Server filter)</h4>
<div class="paragraph">
<p>The PEP (acting on behalf of the resource server) receives the client request to access the protected resource. In the case that the access requires an authenticated user, then the PEP expects that the request includes a valid access token.</p>
</div>
<div class="paragraph">
<p>Thus, the PEP follows the logic:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The PEP checks with the PDP whether an authenticated user is required for access</p>
</li>
<li>
<p>If no authenticated user is required then the request can continue (pending authorization) as an 'anonymous' user</p>
</li>
<li>
<p>If access requires an authenticated user then</p>
<div class="ulist">
<ul>
<li>
<p>If the access token is not present then no user is logged in, so the request should be redirected to the /authorize endpoint (HTTP redirect)</p>
</li>
<li>
<p>If the access token is present, then it should be validated with the Login Service (direct call), as described below</p>
</li>
<li>
<p>If the access token validation completes successfully then the request can continue (pending authorization), with the user identity provided by the ID Token received during token validation</p>
</li>
<li>
<p>If the token is invalid, then the request should be redirected to the /authorize endpoint (HTTP redirect)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_access_token_validation">4.2.6. Access Token Validation</h4>
<div class="paragraph">
<p>The PEP validates the access token by using it as a Bearer token in a request to the Login Service’s /userinfo endpoint. A successful response has two outcomes:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Confirms the validity of the access token from the point-of-view of the Login Service that issued it</p>
</li>
<li>
<p>Provides an ID Token for the user that provides the information required to uniquely identify the user within the EP and utilise this identity within the subsequent policy decision made by the PDP</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The ID Token is a JWT that has been signed by the Login Service. Using the jwks (see section ‘OIDC Federation’) endpoint of the Login Service, the PEP is able to obtain the necessary keys to validate the signature of the ID Token. This provides the full user context for the resource access.</p>
</div>
</div>
<div class="sect3">
<h4 id="_federated_user_access">4.2.7. Federated User Access</h4>
<div class="paragraph">
<p>Based upon the above authentication model, an EP could access the resources of another EP by obtaining an access token through OIDC flows. However, considering that these EP&#8594;EP invocations will typically be Machine-to-machine (M2M), then we need to consider how the end-user (resource owner) is able to complete their consent. Two possibilities are explored in the subsequent sections:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The user pre-authorizes the EP&#8594;EP access in advance of the operation</p>
</li>
<li>
<p>Use of OIDC JWKS for trusted federation of identity between platforms</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_user_pre_authorization">4.2.7.1. User Pre-authorization</h5>
<div class="paragraph">
<p>Using the facilities of the Exploitation Platform, the user (perhaps via their User Profile management console) initiates the authorization flow from one EP to another. The end result is that the originating EP obtains delegated access to another EP on behalf of the user - with the resulting access tokens being maintained within the user&#8217;s profile on the EP.</p>
</div>
<div class="paragraph">
<p>At the point where the EP needs to access a resource on another EP, then the access tokens are obtained from the user&#8217;s profile and used as Bearer token in the resource request to the other EP. Refresh tokens can be used to ensure that authorization is long-lived.</p>
</div>
<div class="paragraph">
<p>Conversly, the user&#8217;s profile at a given EP should also provide the ability to manage any inward authrosations they have granted to other EPs, i.e. ability to revoke a previous authorization by invalidating the refresh token. This would invole interface with the Login Service.</p>
</div>
</div>
<div class="sect4">
<h5 id="_possible_use_of_oidc_jwks_federation">4.2.7.2. Possible use of OIDC JWKS Federation</h5>
<div class="paragraph">
<p>OIDC provides a distributed key-hierarchy that could be used to support federated user access between collaborating exploitation platforms. The concept is explored in this section.</p>
</div>
<div class="paragraph">
<p>Reference: <a href="https://openid.net/specs/openid-connect-federation-1_0.html" class="bare">https://openid.net/specs/openid-connect-federation-1_0.html</a></p>
</div>
<div class="paragraph">
<p>OIDC provides a framework in which RPs and OPs can dynamically establish verifiable trust chains, and so share keys to support signing and validation of JWTs.</p>
</div>
<div class="paragraph">
<p>Dedicated ‘federation’ endpoints are defined that allow an entity (such as RP or OP) to publish their own Entity Statements, and to obtain Statements for other entities that are issued by trusted third-parties within the federation. The metadata/signatures within the Entity Statements establish a chain of trust that can be followed to known (trusted) Trust Anchors, and so the Entity Statements and the included entity public keys can be trusted.</p>
</div>
<div class="paragraph">
<p>Thus, through this mechanism public keys can be shared to underpin the signing and validation of JWTs.</p>
</div>
<div class="paragraph">
<p>Within an EP, when a resource server is executing a user’s request, it may need to invoke a resource in another EP with which it is collaborating. The resource access to the other EP must be made on behalf of the originating user.</p>
</div>
<div class="paragraph">
<p>The nominal solution is for the originating EP to act as an OIDC Client to interface with the Login Service of the other EP, and so obtain the access token required to access the other resource. In this case, we should consider the fact that the resource access may be asynchronous to the end-user request and is not made within the context of the end-user’s user agent. Therefore, we should explore possibilities (flows) provided by OIDC/OAuth that support this type of access.</p>
</div>
<div class="paragraph">
<p>One possibility is to make use of the signed-JWT ID Token that can be carried through the calls into and across resource servers. Through the facilities provided by JSON Web Key Set (JWKS), ID Tokens can be verified and trusted by other platforms operating within the same JWKS key hierarchy.</p>
</div>
<div class="paragraph">
<p>Thus, using the trusted ID Token, it may be possible follow an OIDC/OAuth flow from one EP to another, in which the user is deemed to have a-priori authorized the third-party access. At this point it is only the user’s identity that has been established, with the authorization decision subject to the rules of the PDP/PEP of the remote system. The identified user must have appropriate a-priori permissions (attributes) on the target resources to be granted access, (ref. ‘Federated Attributes’).</p>
</div>
<div class="paragraph">
<p>Thus, it is the ID of the user that has been passed machine-to-machine to facilitate the service federation. This effectively achieves cross-EP single sign-on, without relying upon the user agent of the end-user providing cookies to the other EP.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_additional_oidc_capabilities">4.2.8. Additional OIDC Capabilities</h4>
<div class="paragraph">
<p>OpenID Connect provides some additional functionalities that are of interest in the context of the Common Architecture.</p>
</div>
<div class="sect4">
<h5 id="_oidc_discovery">4.2.8.1. OIDC Discovery</h5>
<div class="paragraph">
<p>Reference: <a href="https://openid.net/specs/openid-connect-discovery-1_0.html" class="bare">https://openid.net/specs/openid-connect-discovery-1_0.html</a></p>
</div>
<div class="paragraph">
<p>OpenID Connect makes provision for two types of discovery:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Discovery of the OpenID Provider Issuer based upon the user’s identifier</p>
</li>
<li>
<p>Discovery of the OpenID Provider Configuration Information</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In the case of our usage within the Exploitation Platform, type 1) is not application since the user’s ID comes from their ‘Home’ organisation and is not (necessarily) tied to an OpenID Connect Provider. Instead the Login Service must implement a discovery ‘flow’ in which the user is able to select the provider of their identity, as one that is supported by the Login Service deployment.</p>
</div>
<div class="paragraph">
<p>Regarding discovery type 2), the Login Service exposes an OIDC Provider interface, and this should support retrieval of OIDC Provider Configuration Information. Thus, OIDC Clients can utilise the discovery interface of the Login Service to exploit its services.</p>
</div>
<div class="paragraph">
<p>This is of most interest in the case of access to federated resources in other EPs, where a resource server in one EP may be acting as an OIDC client of the Login Service in another EP – in which case auto-discovery might be more attractive.</p>
</div>
</div>
<div class="sect4">
<h5 id="_client_registration">4.2.8.2. Client Registration</h5>
<div class="paragraph">
<p>Reference: <a href="https://openid.net/specs/openid-connect-registration-1_0.html" class="bare">https://openid.net/specs/openid-connect-registration-1_0.html</a></p>
</div>
<div class="paragraph">
<p>The possibility exists for the OIDC Client (Login Service) to perform auto-registration with the Login Service, using OIDC Client Registration. In doing so the OIDC client obtains its Client ID and Secret.</p>
</div>
<div class="paragraph">
<p>This may be of interest in a couple of cases:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The case of access to federated resources in other EPs, where a resource server in one EP may be acting as an OIDC client of the Login Service in another EP – in which case auto-client-registration might be of interest.</p>
</li>
<li>
<p>The case where a common Login Service is deployed outside of the context of a given Exploitation Platform, acting as an IdP Proxy. In this case, the local Login Service deployed in each EP would register as an OIDC Client of the IdP Proxy.</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_authorization_policy_decision">4.3. Authorization (Policy Decision)</h3>
<div class="paragraph">
<p>The Authorization flow is relevant to the following interfaces:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>PEP &lt;&#8594; PDP<br>
The PEP, acting as a filter for the access attempt on the resource, defers its authorization decision to the PDP.</p>
</li>
<li>
<p>PDP &lt;&#8594; Other PDP<br>
Aspects of the authorization policy can be delegated from one PDP to another, e.g. to govern resource access through an administrative domain represented by a <em>Virtual Organisation</em>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The approach (data model and protocol) for these two interfaces can be aligned - but is not yet defined in the Common Architecture. At this stage the candidate technologies to be investigated are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XACML (eXtensible Access Control Markup Language)</p>
</li>
<li>
<p>UMA (User-Managed Access)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>XACML and UMA can possibly be used together in an overall solution in which <strong>XACML provides the policy language</strong> through which rules are configured and <strong>UMA provides the ‘protocol’ flows</strong>.</p>
</div>
<div class="sect3">
<h4 id="_xacml_extensible_access_control_markup_language">4.3.1. XACML (eXtensible Access Control Markup Language)</h4>
<div class="paragraph">
<p>XACML defines an architecture in which the access decision is separate from the point of use, and is thus consistent with the high-level IAM approach described in this design document. The XACML architecture framework describes a Request-Response protocol, and a policy language in which access policies are defined as rules comprising attributes. XACML additionally describes the process through which policies are evaluated, for example through <em>combining algorithms</em> that mediate competing rules.</p>
</div>
<div class="sect4">
<h5 id="_xacml_3_0">4.3.1.1. XACML 3.0</h5>
<div class="paragraph">
<p>XACML 3.0 includes some additional aspects that are of interest to our proposed IAM approach. Namely:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Administrative delegation</dt>
<dd>
<p>The delegation mechanism is used to support decentralized administration of access policies. It allows an authority (delegator) to delegate all or parts of its own authority, (or someone else&#8217;s authority), to another user (delegate) without any need to involve modification of the root policy.</p>
</dd>
<dt class="hdlist1">JSON Request/Response Profile</dt>
<dd>
<p>JSON bindings for the request/response messages between the PEP and the PDP - as an alternative to the core XML message definitions.</p>
</dd>
<dt class="hdlist1">REST Profile</dt>
<dd>
<p>Providing REST semantics for the PEP/PDP interface.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_geoxacml">4.3.1.2. GeoXACML</h5>
<div class="paragraph">
<p>GeoXACML is standardised by the OGC to provide a geo-specific extension to XACML 2.0. GeoXACML provides support for spatial data types and spatial authorization decision functions. Those data types and functions can be used to define additional spatial constraints for XACML based policies.</p>
</div>
</div>
<div class="sect4">
<h5 id="_alfa_abbreviated_language_for_authorization">4.3.1.3. ALFA (Abbreviated Language For Authorization)</h5>
<div class="paragraph">
<p>Authoring of XACML rules can be facilitated by the use of <a href="https://en.wikipedia.org/wiki/ALFA_(XACML)"><strong>ALFA (Abbreviated Language For Authorization)</strong></a>, which is a pseudocode language used in the formulation of access-control policies. ALFA policies can be directly converted to XACML 3.0 policies. ALFA can support GeoXACML through extensions, that supports definition of custom geometry functions.</p>
</div>
</div>
<div class="sect4">
<h5 id="_xacml_related_technologies">4.3.1.4. XACML Related Technologies</h5>
<div class="paragraph">
<p>The following items represent some interesting existing implementations that may be considered as a possible basis for a reference implementation of the Common Architecture.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">AuthzForce PDP</dt>
<dd>
<p>An authorization service providing authorization policy decision evaluation and policy administration.<br>
Provides an API to get authorization decisions based on authorization policies, and authorization requests from PEPs. The API follows the REST architecture style, and complies with XACML v3.0.</p>
<div class="ulist">
<ul>
<li>
<p>Project page: <a href="https://fimac.m-iti.org/6d.php" class="bare">https://fimac.m-iti.org/6d.php</a></p>
</li>
<li>
<p>Documentation: <a href="https://authzforce-ce-fiware.readthedocs.io/en/latest/" class="bare">https://authzforce-ce-fiware.readthedocs.io/en/latest/</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">geoPDP</dt>
<dd>
<p>GeoXACML for AuthzForce PDP - extends the AuthZForce PDP implementation with a Geometry data type and related functions as specified in the OGC Implementation Standard GeoXACML 1.0.1.</p>
<div class="ulist">
<ul>
<li>
<p>GitHub page: <a href="https://github.com/securedimensions/authzforce-geoxacml-basic" class="bare">https://github.com/securedimensions/authzforce-geoxacml-basic</a></p>
</li>
<li>
<p>geoPDP Docker: <a href="https://github.com/securedimensions/geopdp-docker" class="bare">https://github.com/securedimensions/geopdp-docker</a></p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">geoPEP</dt>
<dd>
<p>Related to the geoPDP is the geoPEP that delivers a PEP as an Apache2 reverse proxy - implemented as an Apache2 module - interfacing with the geoPDP for the authorization decisions.</p>
<div class="ulist">
<ul>
<li>
<p>geoPEP Docker: <a href="https://github.com/securedimensions/geopep-apache2-reverse-proxy" class="bare">https://github.com/securedimensions/geopep-apache2-reverse-proxy</a></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_uma_user_managed_access">4.3.2. UMA (User-Managed Access)</h4>
<div class="paragraph">
<p>User-Managed Access (UMA) is a profile of OAuth 2.0. UMA defines how resource owners can control protected-resource access by clients operated by arbitrary requesting parties, where the resources reside on any number of resource servers, and where a centralized authorization server governs access based on resource owner policies. Resource owners configure authorization servers with access policies that serve as asynchronous authorization grants.</p>
</div>
<div class="sect4">
<h5 id="_uma_main_actors">4.3.2.1. UMA Main Actors</h5>
<div class="paragraph">
<p>The main UMA actors are briefly summarised as follows:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Resource Owner (RO)</dt>
<dd>
<p>The "user" and the owner of the resource who defines the access authorization - typically the end-user, but it can also be a corporation or other legal person.</p>
</dd>
<dt class="hdlist1">Client</dt>
<dd>
<p>An application making protected resource requests with the Resource Owner&#8217;s authorization and on the Requesting Party&#8217;s behalf - typically a web or native application.</p>
</dd>
<dt class="hdlist1">Resource Server (RS)</dt>
<dd>
<p>The custodian of the resource - typically a service through which access to the resource is gained.</p>
</dd>
<dt class="hdlist1">Authorization Server (AS)</dt>
<dd>
<p>A server that issues <em>Authorization Data</em> and RPTs to a client and protects resources managed at a resource server. Authorization Data is associated with an RPT to enable some combination of the Authorization Server and Resource Server to determine the correct extent of access to allow to a Client.</p>
</dd>
<dt class="hdlist1">Requesting Party (RqP)</dt>
<dd>
<p>The entity that uses a Client to seek access to a protected resource. May be the Resource Owner, or can be some other third party entity requesting access to the resource.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The software components that fill the roles of UMA authorization servers, resource servers, and clients respectively are intended to work in an interoperable fashion when each is operated by an independent party (for example, different organizations).</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In a typical OAuth flow, a human resource owner (RO) operating a client application is redirected to an authorization server (AS) to log in and consent to the issuance of an access token so that the client application can gain access to the resource server (RS) on the RO’s behalf in future, likely in a scoped (limited) fashion. The RS and AS are in all likelihood operating within the same security domain, and any communication between them is not standardized by the main OAuth specification.</p>
</div>
<div class="paragraph">
<p>UMA adds three main concepts and corresponding structures and flows. First, it defines a standardized API at the AS, called the protection API, that the RS speaks to; this enables multiple RS’s to communicate with one AS and vice versa, and because the API is itself secured with OAuth, allows for formal trust establishment between each pair. This also allows an AS to present an RO with a centralized user interface. Second, UMA defines a formal notion of a requesting party (RqP) that is autonomous from an RO, enabling party-to-party sharing and delegation of access authorization. An RO need not consent to token issuance at run time but can set policy at an AS, allowing an RqP to attempt access asynchronously. Third, UMA enables access attempts to result in successful issuance of tokens associated with authorization data based on a process of trust elevation in the RqP, for example, gathering identity claims or other claims from them.</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Wikipedia<br>
<cite>https://en.wikipedia.org/wiki/User-Managed_Access</cite>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_uma_phases">4.3.2.2. UMA Phases</h5>
<div class="paragraph">
<p>UMA describes three phases&#8230;&#8203;</p>
</div>
<div class="olist arabic strong">
<ol class="arabic">
<li>
<p><strong>Protect Resource</strong><br>
The Resource Owner, who manages online resources at the Resource Server, introduces it to the Authorization Server so that the latter can begin protecting the resources. To accomplish this, the Authorization Server presents a <strong><em>Protection API</em></strong> to the resource server. This API is protected by OAuth (or an OAuth-based authentication protocol) and requires a <strong><em>Protection API Token (PAT)</em></strong> for access. Out of band, the Resource Owner configures the Authorization Server with policies associated with the resource sets that the resource registers for protection.</p>
</li>
<li>
<p><strong>Get Authorization</strong><br>
The Client approaches the Resource Server seeking access to an UMA-protected resource. In order to access it successfully, the Client must first use the Authorization Server&#8217;s <strong><em>Authorization API</em></strong> to obtain authorization data and a <strong><em>Requesting Party token (RPT)</em></strong> on behalf of its Requesting Party, and the Requesting Party may need to undergo a process of trust elevation, for example, supplying identity claims. The API is protected by OAuth (or an OAuth-based authentication protocol) and requires an <strong><em>Authorization API Token (AAT)</em></strong> for access.</p>
</li>
<li>
<p><strong>Access Resource</strong><br>
The Client successfully presents to the Resource Server an RPT that has sufficient authorization data associated with it, gaining access to the desired resource.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_uma_terminology">4.3.2.3. UMA Terminology</h5>
<div class="paragraph">
<p>To elaborate the descriptions of these phases, UMA employs a set of terminology that is summarised below&#8230;&#8203;</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">TERMS</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><strong>Policy</strong><br>
The configuration parameters of an authorization server that effect resource access management - typically defined is terms of "subjects", "verbs" and "objects". Policy configuration takes place between the resource owner and the authorization server.</p>
</li>
<li>
<p><strong>Claim</strong><br>
A statement of the value or values of one or more identity attributes of a Requesting Party. A Requesting Party may need to provide claims to an Authorization Server in order to gain permission for access to a protected resource.</p>
</li>
<li>
<p><strong>Resource Set</strong><br>
One or more protected resources that a resource server manages as a set - thus, a Resource Set is the "object" being protected.</p>
</li>
<li>
<p><strong>Scope</strong><br>
A bounded extent of access that is possible to perform on a Resource Set - a scope is one of the potentially many "verbs" that can logically apply to a Resource Set ("object").</p>
</li>
<li>
<p><strong>Permission</strong><br>
A scope of access over a particular Resource Set at a particular Resource Server that is being requested by, or granted to, a Requesting Party. Thus, a Permission is an entitlement that includes a "subject" (Requesting Party), "verbs" (one or more Scopes of access), and an "object" (Resource Set).</p>
</li>
<li>
<p><strong>Permission Ticket</strong><br>
A correlation handle that is conveyed from an Authorization Server to a Resource Server, from a Resource Server to a Client, and ultimately from a Client back to an Authorization Server, to enable the Authorization Server to assess the correct policies to apply to a request for Authorization Data.</p>
</li>
<li>
<p><strong>Authorization Data</strong><br>
Data (e.g. a Permission) associated with an RPT that enables some combination of the Authorization Server and Resource Server to determine the correct extent of access to allow to a Client.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">TOKENS</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><strong>Requesting Party Token (RPT)</strong><br>
An UMA access token associated with a set of Authorization Data, used by the Client to gain access to protected resources at the Resource Server.</p>
</li>
<li>
<p><strong>Authorization API Token (AAT)</strong><br>
An OAuth access token with the scope <strong><em>uma_authorization</em></strong>, used by the Client at the Authorization API <em>'RPT Endpoint'</em>. An AAT binds a Requesting Party, a Client being used by that party, and an Authorization Server that protects resources this Client is seeking access to on this Requesting Party&#8217;s behalf. The issuance of an AAT represents the approval of this Requesting Party for this Client to engage with this Authorization Server to supply claims, ask for authorization, and perform any other tasks needed for obtaining authorization for access to resources at all Resource Servers that use this Authorization Server.</p>
</li>
<li>
<p><strong>Protection API Token (PAT)</strong><br>
An OAuth access token with the scope <strong><em>uma_protection</em></strong>, used by the Resource Server at the Protection API, consisting of the <em>'Resource Set Registration'</em>, <em>'Permission Registration'</em>, and <em>'Token Introspection'</em> endpoints. A PAT binds a Resource Owner, a Resource Server the owner uses for resource management, and an Authorization Server the owner uses for protection of resources at this Resource Server. The issuance of a PAT represents the approval of the Resource Owner for this Resource Server to use this Authorization Server for protecting some or all of the resources belonging to this Resource Owner.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">ENDPOINTS</dt>
<dd>
<div class="ulist">
<ul>
<li>
<p><strong>Authorization API</strong><br>
Requires access token with <em>uma_authorization</em> scope (AAT). An entity that can acquire an access token with this scope is by definition a Client.</p>
<div class="ulist">
<ul>
<li>
<p><strong>RPT Endpoint</strong><br>
An endpoint at the Authorization Server that issues RPTs and Authorization Data to the Client.</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong>Protection API</strong><br>
Requires access token with <em>uma_protection</em> scope (PAT). An entity that can acquire an access token with this scope is by definition a Resource Server.</p>
<div class="ulist">
<ul>
<li>
<p><strong>Resource Set Registration Endpoint</strong><br>
An endpoint at the Authorization Server that allows the Resource Server to register Resource Sets.</p>
</li>
<li>
<p><strong>Permission Registration Endpoint</strong><br>
An endpoint at the Authorization Server that allows the Resource Server to request Permission Tickets.</p>
</li>
<li>
<p><strong>Token Introspection Endpoint</strong><br>
An endpoint at the Authorization Server that allows the Resource Server to query the status of an RPT and its associated Authorization Data.</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_resource_protection">4.3.2.4. Resource Protection</h5>
<div class="paragraph">
<p>The resource owner, resource server, and authorization server perform the following high-level actions to put resources under protection:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The Authorization Server issues client credentials to the resource server, (either dynamically or statically)</p>
</li>
<li>
<p>The Resource Server acquires a PAT from the Authorization Server</p>
</li>
<li>
<p>The Resource Server registers any Resource Sets with the Authorization Server for which it intends to outsource protection, using the Resource Set Registration Endpoint of the Protection API</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_access_resource">4.3.2.5. Access Resource</h5>
<div class="paragraph">
<p>An Authorization Server orchestrates and controls Clients' access on their Requesting Parties' behalf to a Resource Owner&#8217;s protected resources at a Resource Server, under conditions specified by that Resource Owner through policy.</p>
</div>
<div class="paragraph">
<p>The process of getting authorization and accessing a resource always begins with the Client attempting access at a protected resource endpoint at the Resource Server.</p>
</div>
<div class="paragraph">
<p>If the Client&#8217;s attempt has a valid RPT with sufficient Authorization Data, the Resource Owner&#8217;s policies have been met for access to the protected resource, and hence access is granted. See <a href="#img_umaAccessResource">Figure 7</a>.</p>
</div>
<div id="img_umaAccessResource" class="imageblock text-center">
<div class="content">
<img src="./images/uma-access-resource.png" alt="uma access resource" width="544" height="243">
</div>
<div class="title">Figure 7. UMA Access Resource (Success)</div>
</div>
</div>
<div class="sect4">
<h5 id="_resource_server_register_permission">4.3.2.6. Resource Server Register Permission</h5>
<div class="paragraph">
<p>If the Client&#8217;s request at the protected resource has no RPT, or has an invalid RPT or insufficient Authorization Data associated with the RPT as determined through RPT status checking, the Resource Server registers a requested permission with the relevant Authorization Server, and responds to the Client with the resulting Permission Ticket and the Authorization Server&#8217;s location. The extent of the requested permission MUST suffice for the extent of the Client&#8217;s access attempt at that resource. The PAT provided in the API request enables the Authorization Server to map the requested permission to the appropriate Resource Owner. The Authorization Server returns a Permission Ticket in its response for the Resource Server to give to the Client that represents the same extent of requested access that the Resource Server registered. See <a href="#img_umaRegisterPermission">Figure 8</a>.</p>
</div>
<div id="img_umaRegisterPermission" class="imageblock text-center">
<div class="content">
<img src="./images/uma-register-permission.png" alt="uma register permission" width="650" height="371">
</div>
<div class="title">Figure 8. UMA Resource Server Register Permission</div>
</div>
</div>
<div class="sect4">
<h5 id="_client_request_authorization">4.3.2.7. Client Request Authorization</h5>
<div class="paragraph">
<p>In order to access a protected resource successfully, a client needs to present a valid RPT with sufficient authorization data. The client uses the authorization API to acquire an RPT and to ask for authorization data, providing the permission ticket it received from the resource server.</p>
</div>
<div class="paragraph">
<p>The authorization server uses the permission ticket to look up the details of the previously registered requested permission, maps the requested permission to operative resource owner policies based on the resource set identifier and scopes associated with it, potentially requests additional information and receives additional information such as claims, and ultimately responds positively or negatively to the request for authorization data. <strong>The authorization server bases the issuance of authorization data on resource owner policies. Thus, these policies function as authorization that has been granted ahead of time.</strong> See <a href="#img_umaClientRequestAuthorization">Figure 9</a>.</p>
</div>
<div id="img_umaClientRequestAuthorization" class="imageblock text-center">
<div class="content">
<img src="./images/uma-client-request-authorization.png" alt="uma client request authorization" width="936" height="1019">
</div>
<div class="title">Figure 9. UMA Client Request Authorization</div>
</div>
<div class="paragraph">
<p>Optionally, the Authorization Server may need additional information in order to determine whether the Client is authorized to have this authorization data. The Authorization Server response indicates "need_info" including one or more sub-properties with hints about the nature of further required information. The Client then has the opportunity to continue seeking authorization by engaging in follow-on flows with the authorization server, either directly or through redirection of an end-user Requesting Party.</p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mainBilling">4.4. Accounting and Billing</h3>
<div class="paragraph">
<p>The platform must account for resource use both within the platform and in other platforms via federation. In addition, several inter-platform billing models are supported as defined in the use cases, <a href="#EOEPCA-UC">[EOEPCA-UC]</a>. A number of principles must first be established:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Actions are performed within the context of a 'billing identity', which may be different to the user&#8217;s identity.</p>
</li>
<li>
<p>Charges are the result of discrete 'billing events' occuring within a particular 'billing window'. Pricing must consider all events within the window, not events individually (to support, for example, tiered pricing).</p>
</li>
<li>
<p>Different platforms may follow completely different pricing and billing models. The architecture and federation messaging cannot assume any particular method of calculation or for describing prices.</p>
</li>
<li>
<p>Only the platform hosting it can accurately price the use of a licensed Resource or compute resource.</p>
</li>
<li>
<p>Costs may be estimated but the estimate is not required to be binding. Federated access can never rely on binding estimates.</p>
</li>
<li>
<p>Debts can only be created where there is a direct contractual relationship and opportunity for credit control. A user can never owe money directly to another platform unless he has an account with it.</p>
</li>
<li>
<p>A platform prices in a single currency (but could choose to allow a user to settle a bill with another currency). Different federated platforms may choose different currencies.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_billing_identities">4.4.1. Billing Identities</h4>
<div class="paragraph">
<p>A billing identity is a user identity for a user who has established a billing relationship with the platform. A billing user may delegate chargeable service access to other users within the system, permitting that user to use resources billed to the billing identity.</p>
</div>
<div class="paragraph">
<p>Individual platforms may choose models with varying complexity. For example, one platform may require that the billing and user identity are always the same, whilst another may permit a user working on multiple cross-organizational projects to choose the billing identity to use. Identities may be related to organizations, projects, etc, for access control and credit control purposes - but these relationships are not required by the architecture.</p>
</div>
<div class="paragraph">
<p>As required by their purpose, cross-platform messaging will include both the user id and the relevant billing identity.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Both the billing and user identities, and other information such as the location of each one and the type of organization involved, may be relevant to determining prices. This is because the place of supply for VAT purposes must be determined, plus any discounts for, for example, academic use. Note that 'location' means more than 'country' (eg, the Canary Islands have lower VAT than Madrid). Also, some organizations may be treated differently such as international organizations exempt from all tax.
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_billing_service">4.4.2. Billing Service</h4>
<div class="paragraph">
<p>A Billing Service will operate within the platform which receives reports of billing events from other components. These are recorded against the relevant billing identity. Billing events have arbitrary attributes defined in them, which the billing service does not interpret (but are sufficient for the pricing engine, see below), a transaction ID identifying the original user action which caused it, and enough additional information for display to the user. Some example billing events might be:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>1 hour of extra-large-vm</p>
</li>
<li>
<p>12 CPU-hours of container execution time</p>
</li>
<li>
<p>licence for satellite image x</p>
</li>
<li>
<p>execution cost of $x from federated platform y</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Individual components decide when to generate billing events - for example, compute cost billing events may be generated every hour. Billing events may have a start and end or a single time - events with a start and end may be split to keep them within a single billing window.</p>
</div>
<div class="paragraph">
<p>The Billing Service can generate reports for the user. This may involve combining billing events in to line items, such as consolidating VM use in to the number of hours so far this month.</p>
</div>
<div class="paragraph">
<p>The Billing Service will generate bills for each billing window by pricing complete windows. Fixed prices are assigned and recorded at this point. It may also keep track of and, where supported by the platform, initiate payments.</p>
</div>
<div class="paragraph">
<p>To support the PDP and other services, the Billing Service may be required to periodically assess the account&#8217;s standing and make decisions on the acceptibility of resource use. This depends on the billing model in use but could involve checking that credits are not exhausted, checking that a reasonable credit limit has not been reached and the detection of potentially fraudulent behaviour. An account which is no longer in good standing may result in API requests for resource use being denied, or it may result in termination messages being sent in response to billing events.</p>
</div>
<div class="paragraph">
<p>Where billing events are reported in another currency, as may happen with federated resource use, the Billing Service must determine the time and rate for currency exchange.</p>
</div>
</div>
<div class="sect3">
<h4 id="_pricing_engine">4.4.3. Pricing Engine</h4>
<div class="paragraph">
<p>To maximize reusability price calculation is separated in to a different service (but not necessarily a different address space). Given access to a price database describing current, future and past configured prices, a Pricing Engine is otherwise stateless and can:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Given a list of billing events or consolidated line items within a pricing window return calculated rates and prices for each one. For some pricing models this may involve multiple charges for each item or may contain blended rates/prices.</p>
</li>
<li>
<p>Return estimated prices for estimated resource use.</p>
</li>
<li>
<p>Where a platform wished to provide such a service to users, return price information and estimated prices in response to API requests.</p>
</li>
<li>
<p>Given a commercial licence billing event, calculate the charge to the user, the credit to the Licenser and the platform fee.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_commercially_licensed_resources">4.4.4. Commercially Licensed Resources</h4>
<div class="paragraph">
<p>Users may publish Resources which are licensed to others on commercial terms and use the platform to collect payments. There are two types of charges which require support within User Management: time-based and volume-based.</p>
</div>
<div class="paragraph">
<p>Time-based charges occur when a user requests a licence which costs a fixed price for a fixed time (or is permanent), regardless of the accesses made to the Resource. The Data Access Services and Execution Management Services determine when such a licence is required and the licence manager manages the process for buying one, including emitting a billing event. This typically will happen in advance of a request. The licence manager may give the billing service an opportunity to reject the request, if applicable to the platform&#8217;s billing model.</p>
</div>
<div class="paragraph">
<p>Volume-based charges occur as access to a licensed Resource proceeds or completes (for example, on first access to a specific satellite image or for each input image passed to a commercial machine learning model). Again, the licence manager reports these as billing events when a licence requirements check is made.</p>
</div>
<div class="paragraph">
<p>Pricing is specified by the Licenser (in a particular form supported by the platform) and stored by the pricing engine (quantity to price mapping) and licence manager (method for determining which licences and 'quantity'). The licence manager must emit three billing events when license grants are bought: a charge to the user, a credit to the Licenser and a charge to the Licenser representing the platform fee for handling payment processing.</p>
</div>
</div>
<div class="sect3">
<h4 id="_budgets">4.4.5. Budgets</h4>
<div class="paragraph">
<p><mark>TBD</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="_inter_platform_payments">4.4.6. Inter-platform Payments</h4>
<div class="paragraph">
<p>Three different models for federated availability of commercial services are supported, two of which require support from the accounting and billing mechanisms of the platforms involved. This support comes in the form of inter-platform payments, allowing users to pay for executions or Resource licences which are located elsewhere in the federation.</p>
</div>
<div class="paragraph">
<p>Note that <em>three</em> platforms may be involved in providing a chargeable federated commercial service:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The home platform where the user is registered and the action is initiated.</p>
</li>
<li>
<p>The host platform where the licenced Resource or chargeable compute resource is located.</p>
</li>
<li>
<p>The compute platform where processing occurs.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Consider, for example, a processing chain invoked on the home platform which invokes a processing service running on the compute platform using a software container published by a Licenser registered on the host platform. Frequently, two or more of these platforms are the same. However, even if all three are the same the platform may wish to use the same process where payments to a Licenser are involved.</p>
</div>
<div class="sect4">
<h5 id="_inter_platform_payment_model_and_process">4.4.6.1. Inter-platform Payment Model and Process</h5>
<div class="paragraph">
<p>An inter-platform payment supports a User of one platform paying for a service provided by either another platform or by a User of another platform. It&#8217;s important to repeat that a debt is only ever created between two entities which have a legal relationship and an opportunity for credit control. This requires that inter-platform payments involve two or three separate debts being: one from User to home platform, one from home platform to the host platform and the third from the host platform to the User providing the service (if any). The process must also cope with the price not being known in advance in all cases - processing costs in particular may be unpredictable. To support this, the following stages are involved:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Authorization stage</strong>: This provides an opportunity for credit control decisions in advance of debts being incurred. This establishes a maximum amount of debt before a new authorization must be sought or the operation aborted but will not necessarily ever be owed in full. Both home and host platform must agree to authorize an inter-platform payment (the host platform may reject if it doesn&#8217;t believe the home platform will pay). The home platform may 'hold' some account credit from its user or authorize a credit card payment if appropriate in its billing model.</p>
</li>
<li>
<p><strong>Clearing stage</strong>: This occurs after a debt is legally incurred, such as after (some of) the computation or data access is completed. The platform on which the service is provided, the host platform, reports to the home platform how much debt has actually been incurred. It may happen in stages - for example a large authorization may occur, followed by the clearing of smaller amounts after every hour of compute time. It cannot exceed the amount authorized.</p>
</li>
<li>
<p><strong>Settlement stage</strong>: This involves a batch of multiple payments, such as a day or a month of payments. The platforms with payment processing contracts in place must reconcile their records and calculate a net amount owed (potentially in multiple currencies). They must then settle the net debt by making a payment using the banking system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Two different commercial models are supported: bilateral clearing and central clearing. In bilateral clearing every platform must negotiate a contract with every other platform (or as far as possible - incomplete coverage will limit what users can do). This has certain commercial downsides, such as a need for every-pair auditing for accurate reporting of resource use and a danger of incumbents excluding new entrants. In central clearing a clearing house must exist and all platforms form a relationship with the clearing house. The clearing house technical functionality is not further explored here, nor is the management of counterparty risk. The messaging and process is intended to be the same in both models.</p>
</div>
<div class="paragraph">
<p>Where inter-platform payments are used the host platform is acting a subcontractor to the home platform. Should the host platform fail to perform, a dispute resolution process must be used. This is considered out of scope of the architecture, except that payments may be marked as disputed, refunded or charged back. This must be accounted for during reconciliation between platforms.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_federated_commercial_services_without_inter_platform_payments_direct_payments">4.4.7. Federated Commercial Services Without Inter-platform Payments: Direct Payments</h4>
<div class="paragraph">
<p>If inter-platform payments are not available, for example because two platforms do not have a payment agreement, it may still be possible to provide services across multiple platforms providing the user has an account and billing relationship with each one directly. This requires that both platforms recognize both the user and the selected billing identity, and that the billing user has delegated access to the user in both platforms.</p>
</div>
<div class="paragraph">
<p>To handle direct payments the user must authorize the home platform to act on its behalf when submitting requests to the host platform. This is done using OAuth. The home platform must redirect the user to the host platform which then returns an authorization token to the home platform. Federated platforms must run an OAuth endpoint for this purpose and certain restrictions must be put on its functioning (for example on refresh token lifetime).</p>
</div>
<div class="paragraph">
<p>Other system components must then use an access token when making requests to the host platform. The host platform should still report costs and identifiers to the home platform, which must be passed to the Billing Service to be recorded. This aids dispute resolution and the reporting of total costs for particular requests.</p>
</div>
</div>
<div class="sect3">
<h4 id="_estimating_inter_platform_costs">4.4.8. Estimating Inter-platform Costs</h4>
<div class="paragraph">
<p><mark>TBD</mark></p>
</div>
</div>
<div class="sect3">
<h4 id="_relationship_to_system_components">4.4.9. Relationship to System Components</h4>
<div class="paragraph">
<p>The Billing Service handles inter-platform payments and supports direct payments in response to requests from other components, such as the EMS. The direct payment model is very different to inter-platform payments but knowledge of the distinction and when each should be used should be isolated in the Billing Service as much as possible.</p>
</div>
<div class="paragraph">
<p>To support this for volume-based charges, interaction between other system components and the Billing Service proceeds as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prior to federated resource use, a component must make a request to the Billing Service with the estimated cost (or a fixed value if not available) and the identity of the host platform. It must also include the transaction ID for the user action which resulted in the payment.</p>
</li>
<li>
<p>The Billing Service determines what kind of payment handling is available, if any. It returns success or failure and, optionally, an OAuth URL to authorize direct payment.</p>
</li>
<li>
<p>The component proceeds with its activity, incurring charges. The activity occurs on the compute platform, which may also be the home or host platform.</p>
</li>
<li>
<p>The compute platform seeks authorization from the host platform before charges are incurred. The host platform checks that an authorized payment exist (directly between the home and host platform). If the charge is for compute resources then these are the same platform and may be a no-op, but this may not be the case for computation using licensed data or software.</p>
</li>
<li>
<p>If the compute platform seeks access from a host platform which has no authorized payment in place then it must report this to the home platform. The home platform may then request authorization or abort the processing. This may happen if the home platform cannot fully predict the accesses made during computation.</p>
</li>
<li>
<p>The compute platform computes, incurring charges. The compute platform may also access the host platform to retrieve data or software but this may also be cached. The resource use is reported by the compute platform to the host platform - for example, a list of images accessed or processed. This happens in multiple chunks when charges are incurred over time.</p>
</li>
<li>
<p>The host platform clears pieces of the original inter-platform authorization by sending a clearing request directly to the home platform. Note that only the host platform is considered authoritative for calculating the true cost (which is returned here).</p>
</li>
<li>
<p>If the original authorization is exhausted then the home platform may pre-emptively extend it by creating a new payment (with the same transaction ID). Otherwise the host platform must reply to a charge report from the compute platform with a response prohibiting further charges.</p>
</li>
<li>
<p>On receiving such a message the compute platform must suspend further processing and forward the response to the home platform. The home platform must then either seek a new authorization or send an abort message to the compute platform.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For time-based licences the flow can be simpler:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The component requests payment authorization from the Billing Service, specifying an exact price.</p>
</li>
<li>
<p>The component communicates with the host platform to acquire the licence.</p>
</li>
<li>
<p>The host platform sends a payment clearing message to the home platform Billing Service to clear the entire authorization.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_payment_processing_systems">4.4.10. Payment Processing Systems</h4>
<div class="paragraph">
<p>Payment processing itself, in particular card payment processing, may be initiated by the Billing Service but should be strictly separate from it. <a href="#PCI-DSS">[PCI-DSS]</a> imposes many onerous requirements not just on the software and hardware used for payment processing, but also on the wider organization and its processes (for example, for formal change reviews and code reviews, the use of specialist cryptographic hardware security modules, the separation of duties between staff and requirements in recruitment and training). For these reasons some implementers will need to avoid card processing within the system entirely and redirect users to externally hosted payment servers. This may constrain them to an account credit-based model whilst other providers may be able to initiate an authorization or full payment on-demand.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_user_profile">4.5. User Profile</h3>
<div class="paragraph">
<p>The User Profile is a system resource that maintains a set of data for each user including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User details</p>
</li>
<li>
<p>Terms and conditions accepted by the user</p>
</li>
<li>
<p>Licence keys held by the user</p>
</li>
<li>
<p>User API key management</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The User Profile for a given user is tied to the unique identifier provided by their Home-IdP through the authentication process.</p>
</div>
<div class="sect3">
<h4 id="_licence_and_tc_management">4.5.1. Licence and T&amp;C Management</h4>
<div class="paragraph">
<p>A licence manager must determine whether or not licence requirements permit certain actions by a certain user. For freely available resources simple acceptance of the licence may be necessary. For commercially licensed resources it may be much more complicated. For example, a licence may have been bought for non-educational use by up to 5 users for satellite images with a certain resolution and area, with an extra charge made for images less than 15 degrees off nadir. Alternatively, a commercially licensed processing service may be charged by the CPU-hour or user-month. This is handled by the pricing and billing services, but acceptance of these terms must still be made first.</p>
</div>
<div class="paragraph">
<p>Some concepts applicable within the licence manager must be established:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A licence consist of the legal text itself, a name and version, a description of pricing where appropiate and other metadata.</p>
</li>
<li>
<p>A licence terms acceptance is the acceptance by a particular user (and organization) of the licence terms and conditions.</p>
</li>
<li>
<p>A licence grant grants a users access to particular parts of a resource or for particular purposes. This is only applicable to commercial licensed resources. A licence grant is signed by the licenser.</p>
</li>
<li>
<p>The licence manager does not know which resources require which licences. It only knows data about identified licences and about which users have which acceptances and grants.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The licence manager does not formally know how to calculate the price of a commercial licence grant. Instead, it produces an identifier for a particular type of grant and a quantity. The billing engine turns this in to a price, which may involve applying any user-specific or volume-based discounts. The quantity may be in, for example, square kilometres. Alternatively, the licences may be priced at €1/unit, effectively transferring responsibility to the licence manager&#8217;s configuration.</p>
</div>
<div class="paragraph">
<p>Note that licencers must ensure that their licences are uniquely identified across the whole federation. That is, if they use the same licence on multiple platforms they must give it the same ID and must not otherwise reuse IDs.</p>
</div>
<div class="sect4">
<h5 id="_licence_requirement_checks">4.5.1.1. Licence Requirement Checks</h5>
<div class="paragraph">
<p>At the request planning stage the EMS determines the licences required (as far as is possible in advance). This results in a list of licence requirement specifications. These may vary in complexity, from simply identifying a dataset to specifying an AoI, ToI and additional attributes, depending on platform support and on any knowledge the EMS has about which request fields are licence-relevant. The licence manager, however, only performs matching of these against rules or configuration using no or limited knowledge of the specific meaning of fields.</p>
</div>
<div class="paragraph">
<p>On receiving licence requirement specifications, the licence manager must compare them against the licences and grants possessed by the user and determine what licences, if any, must be obtained by the user before the action is permitted. On failure, the result should contain something the user can act on, such as a URL for viewing and agreeing to dataset terms or for buying licences. On success, the licence manager may return information on which fields were used so that the EMS can avoid repeated checks.</p>
</div>
<div class="paragraph">
<p>The licence manager should also be able to determine when additional commercial licence grants should be added (and charged for) automatically. The user must have previously agreed to the license terms and pricing. When a new licence grant is added it should record it and issue a billing event.</p>
</div>
<div class="paragraph">
<p>Licence grants may also be managed by an external service operated by the licenser. This communication is managed entirely by the licence manager.</p>
</div>
<div class="paragraph">
<p>Processing may cross platform boundaries within the federation. A platform executing processing or supplying a resource must be able to determine that the processing is running in a context in which any required licences are available. To support this, the context must include enough information to identify the licence manager of the originating platform. When a licence manager receives a licence requirement specification which can&#8217;t be satisfied locally it should use this endpoint to perform a licence requirement check. The originating platform may fail this request, may accept it based on existing data (returning signed licence grants if appropriate) or may perform an automated licence grant acquisition. The host/compute platform may then store these licence grants against the user ID for use in future checks.</p>
</div>
<div class="paragraph">
<p>Note that cross-platform executions may involve running, for example, a processing chain initiated from platform A with a component involving a commercially licenced compute service from platform B running on platform C. In these cases platform B may check that the user has accepted its platform acceptable use policy by contacting platform A, fetch the compute service from platform C which will then also directly contact platform A to ensure that licences are available before returning the container ot platform B.</p>
</div>
<div class="paragraph">
<p>TODO: Diagrams!</p>
</div>
</div>
<div class="sect4">
<h5 id="_licence_acquisition">4.5.1.2. Licence Acquisition</h5>
<div class="paragraph">
<p>Unless managed by an external service, users must be able to view and accept terms and purchase licence grants using the licence manager. For licences where no licence grants must be bought this is very simple - for example, the licence manager may provide APIs enabling the UI to fetch licence text and submit acceptance. This can be done from a resource information display page or following a refused request.</p>
</div>
<div class="paragraph">
<p>Where a licence grant must be bought the flow for the user is managed by other components. A user interface may be used to choose licence attributes or particular subsets of data, for example, or a user may have the option to allow automatic purchases as data is accessed. This licence manager must support this functionality in the following ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A human-readable description of the pricing model and prices is included with the licence metadata. This should be displayed to the user.</p>
</li>
<li>
<p>The licence manager can accept a licence requirement specification and turn it in to either a product code and quantity (which the caller can then pass to the pricing engine) or information on which additional fields are required. The field names, types and UI information is supplied by other services as part of the resource definition.</p>
</li>
<li>
<p>The licence manager can accept a command to buy a specified licence. It will then emit a billing event. This may happen synchronously or asynchronously depending on the needs of the platform&#8217;s billing model.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>When federated access is involved, such as when a processing chain runs some components on another platform or when data or processing services are transferred to run locally, a user may need to accept licence terms or acquire a licence grant for a resource which is not published via the home platform. This must always be initiated from the home platform, either in advance of the execution or in response to an event returned by a host platform. For terms acceptance the licence manager must contact the host platform and transfer the necessary T&amp;C data. For a (commercial) licence grant, the licence manager must ask the billing manager to authorize a payment to the host platform and then make a request to the host licence manager to buy the licence (specifying the payment ID). The host licence manager must verify the price before asking its own billing manager to clear the payment. It should then record the licence grant as well as returning it to the home platform.</p>
</div>
</div>
<div class="sect4">
<h5 id="_licence_administration">4.5.1.3. Licence Administration</h5>
<div class="paragraph">
<p>Resource owners must be able to configure licences. The UIs and APIs allowing them to do this must interact with the licence manager (and the pricing engine) to configure their licences. This includes only the licences themselves - assignment of licence requirements to resources is out of the licence manager&#8217;s scope.</p>
</div>
</div>
<div class="sect4">
<h5 id="_porting_licences_within_the_federation">4.5.1.4. Porting Licences Within the Federation</h5>
<div class="paragraph">
<p>In some cases users may have multiple home platforms, initiating some workloads from different locations. To ensure that users can use their licences for workloads initiated across all locations licence 'porting' may be used.</p>
</div>
<div class="paragraph">
<p>A user 'ports' a licence from one platform to another by using OAuth to authorize the licence manager on the local platform to access his licences on another. This is only permitted if the licences have been marked as 'portable' by the licenser.</p>
</div>
<div class="paragraph">
<p>This mechanism may be used for two purposes. In the first, a publisher has published his Resource in both platforms (which may be done to permit lower processing latencies, lower payment processing costs or the use of proprietary features). The platform receiving the licence must verify its signature using the licenser&#8217;s public key before accepting it. In the second case the Resource is not available on the receiving platform but may still be used in cross-platform workflows (including the case when a processing service is transferred from a remote host platform to execute locally).</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mainProcessingAndChaining">5. Processing and Chaining</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Processing &amp; Chaining domain area must provide an extensible repository of processing functions, tools and applications (referred here generically as ‘processing services’) that can be discovered by search query, invoked individually, and utilised in workflows.</p>
</div>
<div class="paragraph">
<p>The Resource Management domain area provides the facilities through which processing services are published in an Application Catalogue that acts as a Marketplace and facilitates their discovery, (see section <a href="#mainAppCatalogue">Application Catalogue</a>). Via the Marketplace users have a single point of access to all processing services that are published across the federated system. In order to invoke processing services and workflows, users must specify the data inputs and parameterisation.</p>
</div>
<div class="paragraph">
<p>Users must be able to define and execute workflows that chain processing steps, in which the input(s) of a step are provided by the output of preceding step(s). Users can publish workflows as new processing services, and so the possibility of workflow nesting.</p>
</div>
<div class="paragraph">
<p>A workflow comprises multiple steps (processing service invocations), each of which can be executed on the platform that is closest to the data. Thus, the workflow must be orchestrated to invoke the steps on the appropriate platform and stage in/out the data between platforms along the execution pipeline. Thus, processing services should be relocatable between federated EO platforms, such that they can be deployed and instantiated for execution ‘close to the data’. This implies that applications are packaged in a way that is self-contained, standardised and agnostic of the underlying hosting technology.</p>
</div>
<div class="paragraph">
<p>Users must be able to develop and integrate their own processing services into the platform. Once integrated the user can publish their processing service so that it is discoverable by search query and available in the federated marketplace – and hence available for exploitation by other users, including use in workflows. In support of this, an integrated development environment should be provided that allows users to develop, test and debug their applications before submission.</p>
</div>
<div class="paragraph">
<p>The interface between the Processing Framework and the compute resource should be abstract so that the solution is not tied to any particular provider (cloud, DIAS, etc.).</p>
</div>
<div id="img_processingUseCase" class="imageblock text-center">
<div class="content">
<img src="./images/use-cases-processing.png" alt="use cases processing" width="100%">
</div>
<div class="title">Figure 10. Processing &amp; Chaining Use Case</div>
</div>
<div class="paragraph">
<p>In meeting these requirements the following key challenges are identified:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Processing and data interoperability must be established through clear and consistent metadata definitions, to ensure that type mismatches are avoided. This is particularly challenging across federated systems where it becomes more difficult to enforce use of common profiles and vocabularies</p>
</li>
<li>
<p>Defining an application packaging approach whose paradigm is easy to work with, whilst providing a rich environment that allows expert users to exploit the full compute capability of the platform</p>
</li>
<li>
<p>Federation of processing services across the network of EO resources, such that processing implementations can be made available ‘on-demand’ amongst federated platforms, to facilitate the movement of the “processing to the data”. Use of a common packaging format that is agnostic of underlying host characteristics is key to this challenge</p>
</li>
<li>
<p>Enforcement of access controls to processing and data resources through multi-step federated workflows requires the user’s ‘request context’ to be carried through all layers of the request fulfilment. At each point of resource access, the user’s identify and access rights must be asserted. The service interface standards, (such as WPS, CSW, WCS, etc.), must be evaluated and necessary enhancements identified to ensure that the user’s access envelope is respected</p>
</li>
</ul>
</div>
<div class="sect2">
<h3 id="_solution_overview">5.1. Solution Overview</h3>
<div class="paragraph">
<p>The Processing &amp; Chaining solution is based upon the work performed in the OGC Testbeds, described by the following Engineering Reports:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OGC 17-023 - OGC Testbed-13, EP Application Package ER <a href="#TB13-AP">[TB13-AP]</a></p>
</li>
<li>
<p>OGC 17-024 - OGC Testbed-13, Application Deployment and Execution Service ER <a href="#TB13-ADES">[TB13-ADES]</a></p>
</li>
<li>
<p>OGC 18-049r1 – OGC Testbed-14, Application Package Engineering Report <a href="#TB14-AP">[TB14-AP]</a></p>
</li>
<li>
<p>OGC 18-050r1 - ADES &amp; EMS Results and Best Practices Engineering Report <a href="#TB14-ADES">[TB14-ADES]</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Additionally, the current OGC Testbed-15 Thread-2 Earth Observation Process and Application Discovery (EOPAD).</p>
</div>
<div class="paragraph">
<p>Processing-services are packaged as Docker images, which can then be deployed as self-contained applications within the Exploitation Platform’s processing framework. OGC-WPS provides a standard interface to expose all processing services (and workflows) for invocation by WPS clients.</p>
</div>
<div class="paragraph">
<p>Each processing service is described by an Application Descriptor, which is a file that accompanies its deployment to the processing framework of the EP. The Application Descriptor provides all the metadata required to accommodate the processor within the WPS service and make it available for execution.</p>
</div>
<div class="paragraph">
<p>The architecture is defined by the following main components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><a href="#mainProcEMS">Execution Management Service (EMS)</a></dt>
<dd>
<p>WPS-T (REST/JSON) service that provides an umbrella orchestration service to deploy/invoke processing services within the ADES of the appropriate (close to data) Exploitation Platform. Thus, the EMS is responsible for the orchestration of workflows, including the possibility of steps running on other (remote) platforms, and the on-demand deployment of processors to local/remote ADES as required.</p>
</dd>
<dt class="hdlist1"><a href="#mainProcADES">Application Deployment and Execution Service (ADES)</a></dt>
<dd>
<p>WPS-T (REST/JSON) service that incorporates the Docker execution engine, and is responsible for the execution of the processing service (as a WPS request) within the ‘target’ Exploitation Platform (i.e. one that is close to the data). The ADES relies upon the EMS to ensure that the processor is deployed as a WPS service before it is invoked.</p>
</dd>
<dt class="hdlist1"><a href="#mainAppCatalogue">Application Catalogue (ref. Resource Management domain)</a></dt>
<dd>
<p>An Application Catalogue provides an inventory of processing services that acts as a Marketplace for the discovery and browse for processing services. The Application Catalogue provides a service that can be searched by facet/keyword and provides supporting metadata and information.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Thus, each platform that supports processing should include an ADES, and each platform that supports workflow orchestration should include an EMS.</p>
</div>
<div class="paragraph">
<p><a href="#img_procOverview">Figure 11</a> illustrates the main architecture components and their interfaces.</p>
</div>
<div id="img_procOverview" class="imageblock text-center">
<div class="content">
<img src="./images/processing-overview.png" alt="processing overview" width="100%">
</div>
<div class="title">Figure 11. Processing &amp; Chaining Overview</div>
</div>
<div class="paragraph">
<p>In order for processing services and their data input/outputs to be aligned a formalism is required to describe the data types for M2M consumption. This is required to ensure that a processor is invoked with compatible data inputs, its outputs are understood, and that coherent workflows can be constructed in which the outputs &#8594; inputs are aligned. For this purpose, Common Workflow Language (CWL) is used in the Application Package Description to describe the processor input/ouputs.</p>
</div>
<div class="paragraph">
<p>The Application Catalogue is the subject of the current Testbed-15 through which the Data Model and catalogue Service Interface are being explored.</p>
</div>
<div class="paragraph">
<p>For the Expert User with a service/application to execute in the EP, we might consider three levels of integration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Importing</strong><br>
The service/application is packaged (unchanged) as a black-box.<br>
Relies upon the stage-in/out of data to the applications existing data access expectations by the Processing Framework.</p>
</li>
<li>
<p><strong>Adapting</strong><br>
The service/application is adapted (modified) to use the data access interfaces offered by the Common Architecture.</p>
</li>
<li>
<p><strong>Porting</strong><br>
The service/application is ported to use the services of the EP intrinsically - typically by use of the <a href="#mainClientLibrary">Client Library</a> defined by the common architecture.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><em>Section <a href="#procServiceDataAccess">Processing Service Data Access</a> provides further discussion regarding the data stage-in/out approach for processing services.</em></strong></p>
</div>
</div>
<div class="sect2">
<h3 id="procK8s">5.2. Resource Layer (Infrastructure) Interface</h3>
<div class="paragraph">
<p>The Processing &amp; Chaining has significant points of interface with the hosting infrastructure for provision of scalable compute resource and access to data for input/output. The definition of this interface should be agnostic of the infrastructure provider onto which the Exploitation Platform is deployed.</p>
</div>
<div class="paragraph">
<p>Kubernetes provides an infrastructure abstraction layer that allows the EP to be architected in a way that is agnostic to the underlying hosting infrastructure – the only requirement being the existence of a K8s cluster in which to deploy and run the platform. This abstraction provides points of interface for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>System deployment</p>
</li>
<li>
<p>Access to back-end data</p>
</li>
<li>
<p>Execution of processing services and applications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Thus, the Processing &amp; Chaining solution is designed to utilise a Kubernetes Cluster, whose API provides the means to invoke the WPS processing services as docker containers, and also provides the means to support stage-in/out of data for the process execution.</p>
</div>
<div class="paragraph">
<p>This has particular impact on the ADES, as described in <a href="#ADES">[ADES]</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="mainAppPackage">5.3. Application Packaging</h3>
<div class="paragraph">
<p>The Application Package provides a platform independent and self-contained representation of a software item, providing executable, metadata and dependencies such that it can be deployed to and executed within an Exploitation Platform. Typically, in the context of the exploitation platform, the application is an EO data processing algorithm or a workflow.</p>
</div>
<div class="paragraph">
<p>The Application Package allows the application to be exchanged in an interoperable way on any platform within the EP ecosystem. Additionally, the developer of the package need only concern themselves with conformance to the package specification and need not concern themselves with the infrastructure details of any particular EP.</p>
</div>
<div class="paragraph">
<p>The Application Package comprises two main parts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Application Descriptor - metadata descriptor file</p>
</li>
<li>
<p>Application Artefact – i.e. the ‘software’ component that represents to the execution unit</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In accordance with the approach advocated in OGC Testbed-14 (ref. <a href="#TB14-ADES">[TB14-ADES]</a>), the Application Descriptor is encoded in accordance with the WPS-T DeployProcess document defined by WPS-T JSON encodings (ref. <a href="#WPS-REST-JSON">[WPS-REST-JSON]</a>). In this way, the Application Descriptor broadly provides the following details:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A link to the application execution unit</p>
</li>
<li>
<p>A description of the application’s inputs and outputs</p>
</li>
<li>
<p>Other auxiliary information</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Currently supported are two types of application execution unit:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Docker container</p>
</li>
<li>
<p>Workflow, expressed in CWL</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>…but the design of the application package should be extensible to support future types.</p>
</div>
<div class="paragraph">
<p>The Application Descriptor must address the needs of at least two types of users:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Application Developers</dt>
<dd>
<p>Who may not be IT experts (such as scientists), requiring an encoding that is simple enough for them to create for themselves</p>
</dd>
<dt class="hdlist1">Machine-To-Machine (M2M)</dt>
<dd>
<p>Requiring all the information to ensure that the application is fully portable and will behave the same on all supporting platforms</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p><a href="#img_procAppDescriptor">Figure 12</a> provides an illustration of the Application Descriptor structure.</p>
</div>
<div id="img_procAppDescriptor" class="imageblock text-center">
<div class="content">
<img src="./images/processing-application-descriptor.png" alt="processing application descriptor" width="70%">
</div>
<div class="title">Figure 12. Structure of Application Descriptor data model</div>
</div>
<div class="paragraph">
<p>Thus, the WPS-T DeployDocument comprises the following parts:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">processDescription (WPS Process Description (WPD))</dt>
<dd>
<p>Corresponds to a WPS Process Description document encoded in JSON, including details such as process ID, name, title, etc. as well as options to describe the job invocation and the output handling.<br>
Additional points of note:</p>
<div class="ulist">
<ul>
<li>
<p>cwlDescriptor<br>
The cwlDescriptor provides a CWL formatted (YAML) workflow definition of the application. This aids the stage-in/out of data by providing a CWL definition of the input/outputs of the application, and is given in addition to the inputs/outputs included in the body of the WPD. This entry is included as an extension to the WPD via an owsContext offering.<br>
<em>Note that this is not required for the Execution Unit type of ‘workflow’ which already carries its CWL file in its executionUnit parameter.</em></p>
</li>
<li>
<p>inputs/outputs<br>
Specifies the number and types of the data input/outputs. Provided as part of the WPD, and in addition to the contents of cwlDescriptor.<br>
The inputs can be provided as references to data, accessible through data access service endpoints, or can be specified as query parameters collection/AOI/TOI.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">executionUnit</dt>
<dd>
<p>Specifies the ‘software’ item to be executed, within the context of the deploymentProfileName, as follows:</p>
<div class="ulist">
<ul>
<li>
<p>dockerizedApplication<br>
executionUnit specifies the URL of the docker image to run.</p>
</li>
<li>
<p>workflow<br>
executionUnit specfies the URL of the CWL file that defines the workflow.</p>
</li>
</ul>
</div>
</dd>
<dt class="hdlist1">deploymentProfileName</dt>
<dd>
<p>Enumerates the type of the executionUnit. Currently supported:</p>
<div class="ulist">
<ul>
<li>
<p>Docker image (<a href="http://www.opengis.net/profiles/eoc/dockerizedApplication" class="bare">http://www.opengis.net/profiles/eoc/dockerizedApplication</a>)</p>
</li>
<li>
<p>CWL Workflow (<a href="http://www.opengis.net/profiles/eoc/workflow" class="bare">http://www.opengis.net/profiles/eoc/workflow</a>)</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="title">Example Application Descriptor</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
  <span class="key"><span class="delimiter">&quot;</span><span class="content">processDescription</span><span class="delimiter">&quot;</span></span>: {
    <span class="key"><span class="delimiter">&quot;</span><span class="content">process</span><span class="delimiter">&quot;</span></span>: {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EoepcaProcessor</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EOEPCA Processor</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">owsContext</span><span class="delimiter">&quot;</span></span>: {
        <span class="key"><span class="delimiter">&quot;</span><span class="content">offering</span><span class="delimiter">&quot;</span></span>: {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">code</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.opengis.net/eoc/applicationContext/cwl</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span>: {
            <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">https://eoepca.github.io/processor/cwl/EOEPCAProcessor.cwl</span><span class="delimiter">&quot;</span></span>
          }
        }
      },
      <span class="key"><span class="delimiter">&quot;</span><span class="content">abstract</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="delimiter">&quot;</span></span>,
      <span class="key"><span class="delimiter">&quot;</span><span class="content">keywords</span><span class="delimiter">&quot;</span></span>: [],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">inputs</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">images</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Input Images</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">formats</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">mimeType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">application/zip</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
            }
          ],
          <span class="key"><span class="delimiter">&quot;</span><span class="content">minOccurs</span><span class="delimiter">&quot;</span></span>: <span class="integer">1</span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">maxOccurs</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">unbounded</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">additionalParameters</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.opengis.net/eoc/applicationContext/inputMetadata</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">parameters</span><span class="delimiter">&quot;</span></span>: [
                {
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">name</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">EOImage</span><span class="delimiter">&quot;</span></span>,
                  <span class="key"><span class="delimiter">&quot;</span><span class="content">values</span><span class="delimiter">&quot;</span></span>: [
                    <span class="string"><span class="delimiter">&quot;</span><span class="content">true</span><span class="delimiter">&quot;</span></span>
                  ]
                }
              ]
            }
          ]
        }
      ],
      <span class="key"><span class="delimiter">&quot;</span><span class="content">outputs</span><span class="delimiter">&quot;</span></span>: [
        {
          <span class="key"><span class="delimiter">&quot;</span><span class="content">id</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">output</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">title</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">Stacked Image</span><span class="delimiter">&quot;</span></span>,
          <span class="key"><span class="delimiter">&quot;</span><span class="content">formats</span><span class="delimiter">&quot;</span></span>: [
            {
              <span class="key"><span class="delimiter">&quot;</span><span class="content">mimeType</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">image/tiff</span><span class="delimiter">&quot;</span></span>,
              <span class="key"><span class="delimiter">&quot;</span><span class="content">default</span><span class="delimiter">&quot;</span></span>: <span class="value">true</span>
            }
          ]
        }
      ]
    },
    <span class="key"><span class="delimiter">&quot;</span><span class="content">processVersion</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">1.0.0</span><span class="delimiter">&quot;</span></span>,
    <span class="key"><span class="delimiter">&quot;</span><span class="content">jobControlOptions</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">async-execute</span><span class="delimiter">&quot;</span></span>
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">outputTransmission</span><span class="delimiter">&quot;</span></span>: [
      <span class="string"><span class="delimiter">&quot;</span><span class="content">reference</span><span class="delimiter">&quot;</span></span>
    ]
  },
  <span class="key"><span class="delimiter">&quot;</span><span class="content">executionUnit</span><span class="delimiter">&quot;</span></span>: [
    {
      <span class="key"><span class="delimiter">&quot;</span><span class="content">href</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">hub.docker.com/eoepca/processor:latest</span><span class="delimiter">&quot;</span></span>
    }
  ],
  <span class="key"><span class="delimiter">&quot;</span><span class="content">deploymentProfileName</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">http://www.opengis.net/profiles/eoc/dockerizedApplication</span><span class="delimiter">&quot;</span></span>
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mainProcEMS">5.4. Execution Management Service (EMS)</h3>
<div class="paragraph">
<p>The EMS provides a Transaction WPS 2.0 (WPS-T) interface, with REST/JSON encodings, as described in section <a href="#_wps_t_restjson">WPS-T REST/JSON</a>.</p>
</div>
<div class="paragraph">
<p>WPS-T extends standard WPS by adding DeployProcess and UndeployProcess operations. Once a process has been deployed to a WPS then the existing wps:Execute operation remains applicable for execution in the standard way.</p>
</div>
<div class="paragraph">
<p>The EMS provides a WPS-T (REST/JSON) interface that provides an umbrella orchestration service to deploy/invoke processing services within the ADES of the appropriate (close to data) Exploitation Platform. Thus, the EMS is responsible for the orchestration of workflows, including the possibility of steps running on other (remote) platforms, and the on-demand deployment of processors to local/remote ADES as required.</p>
</div>
<div class="paragraph">
<p>The description in this section refers to the WPS operations: GetCapabilities, DescribeProcess, Execute, GetStatus, GetResult, DeployProcess, UndeployProcess. See <a href="#_wps_t_restjson">WPS-T REST/JSON</a> for a mapping of these operations into the REST/JSON encoding.</p>
</div>
<div class="paragraph">
<p>The EMS provides the endpoint for the user’s web client, through which applications and workflows are deployed to the EMS to make them available for execution.</p>
</div>
<div class="paragraph">
<p><a href="#img_procEmsDeploy">Figure 13</a> illustrates the deployment of applications and workflows to the EMS.</p>
</div>
<div id="img_procEmsDeploy" class="imageblock text-center">
<div class="content">
<img src="./images/processing-EMS-deploy.png" alt="processing EMS deploy" width="90%">
</div>
<div class="title">Figure 13. EMS Deployment</div>
</div>
<div class="paragraph">
<p>Applications are deployed to the EMS so that they are available for inclusion in workflows.</p>
</div>
<div class="paragraph">
<p>Workflows are deployed to the EMS where the steps of the workflow reference applications that are known to the EMS.</p>
</div>
<div class="paragraph">
<p>As illustrated in <a href="#img_procEmsExecute">Figure 14</a>, the EMS orchestrates the workflow execution by invoking the steps as subordinate invocations of wps:Execute at the ADES identified at time of task invocation. The EMS uses wps-t:DeployProcess on the target ADES to ensure that the process is registered before execution.</p>
</div>
<div id="img_procEmsExecute" class="imageblock text-center">
<div class="content">
<img src="./images/processing-EMS-execute.png" alt="processing EMS execute" width="100%">
</div>
<div class="title">Figure 14. EMS Workflow Execution</div>
</div>
<div class="paragraph">
<p>At time of <code>wps:Execute</code> the input data must be specified by the invoking user. Two possibilities are currently identified, both of which should be supported by EMS:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Direct URL references to specific data products, accessible through data access service endpoints (such as WCS, WFS, etc.)</p>
</li>
<li>
<p>OpenSearch query parameters that identify the data characteristics as a combination of Collection/AOI/TOI</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In case 1) the EMS can simply pass-through the input arguments to the ADES WPS-T.</p>
</div>
<div class="paragraph">
<p>In case 2) the EMS must resolve the input data by OpenSearch catalogue queries with the provided parameters. The OpenSearch catalogue end-point can either be defined by the application (in its Application Descriptor), or defined as a parameter of the <code>wps:Execute</code>.</p>
</div>
<div class="paragraph">
<p>In either case, the end result is that the EMS resolves the input specification to a set of data products URLs that can be passed on to the ADES for execution.</p>
</div>
<div class="paragraph">
<p>The EMS requires a means to determine the target platform (ADES) for the execution, i.e. typically the one closest to the data. In the case of the OGC Testbeds, this determination was made as a one-to-one mapping from the collection identified in the input data specification. If collections are identified to be globally unique, e.g. with a namespace prefix that identifies the hosting platform, then this assertion can be reliably made and the target ADES can be derived from the collection ID. Otherwise, the <code>wps:Execute</code> must be parameterised suitably to identify the target ADES.</p>
</div>
<div class="paragraph">
<p>Performing the orchestration between steps, the EMS must handle the stage-in and stage-out of data. In the simple case, the result URL returned from a step can be directly used as an input URL for the subsequent step. Use of CWL and the accompanying <code>cwl-runner</code> tool should facilitate this orchestration.</p>
</div>
<div class="paragraph">
<p>The end result of the successful execution is to present the output result to the invoking user. The EMS establishes the location of the results within the storage provision of the Exploitation Platform, and interfaces with the EP Workspace component (<a href="#mainWorkspace">Workspace</a>) to register the result in the user’s workspace. At this point the WPS execution is complete as reported by the <code>wps:GetStatus</code> and <code>wps:GetResult</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="mainProcADES">5.5. Application Deployment and Execution Service (ADES)</h3>
<div class="paragraph">
<p>The ADES provides a WPS-T (REST/JSON) service that incorporates the Docker execution engine, and is responsible for the execution of the processing service (as a WPS request) within the ‘target’ Exploitation Platform (i.e. one that is close to the data). The ADES relies upon the EMS to ensure that the processor is deployed as a WPS service before it is invoked.</p>
</div>
<div class="paragraph">
<p>The main responsibilities of the ADES are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Check the user is authorized to access the requested data</p>
</li>
<li>
<p>Perform stage-in of data before execution</p>
</li>
<li>
<p>Invoke the container from the Docker image in accordance with the ApplicationDescriptor and the <code>wps:Execute</code> request</p>
</li>
<li>
<p>Monitor the status of the job and obtain the results</p>
</li>
<li>
<p>Perform stage-out of results at execution conclusion</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><a href="#procK8s">Resource Layer (Infrastructure) Interface</a> introduces the use of Kubernetes (K8s) as the provider agnostic interface to the Resource Layer. The ADES has touch-points with the Resource Layer for access to data and compute resource. The following sub-sections elaborate the approach.</p>
</div>
<div class="paragraph">
<p>The work carried out in the OGC Testbeds 13/14, performed the execution of the ‘packaged’ processing service by invoking the ‘run’ of a docker container in the machine that hosts the WPS-T service. The Common Architecture design builds upon this, by instead invoking the container as a K8s Job that is deployed for execution in the K8s cluster.</p>
</div>
<div class="paragraph">
<p>This approach is consistent with the current Application Package / ADES definition that specifies a docker image for the processing service. As illustrated in <a href="#img_procAdesExecute">Figure 15</a>, the ADES provides a K8s-aware Execution Engine that handles the complexities of constructing the jobs and interfacing with the K8s cluster.</p>
</div>
<div id="img_procAdesExecute" class="imageblock text-center">
<div class="content">
<img src="./images/processing-ADES-execute.png" alt="processing ADES execute" width="85%">
</div>
<div class="title">Figure 15. ADES Process Execution</div>
</div>
<div class="paragraph">
<p>A Kubernetes cluster comprises a set of Nodes. A Node is a worker machine in Kubernetes and may be either a virtual or a physical machine. Each Node is managed by the Master. A Node can have multiple pods, and the Kubernetes master automatically handles scheduling of the pods across the Nodes in the cluster. The Master&#8217;s automatic scheduling takes into account the available resources on each Node.</p>
</div>
<div class="paragraph">
<p>Pods are the atomic unit on the Kubernetes platform. A Pod is a Kubernetes abstraction that represents a group of one or more application containers. A Pod always runs on a Node. The containers in a Pod share an IP Address and port space, are always co-located and co-scheduled, and run in a shared context on the same Node.</p>
</div>
<div class="paragraph">
<p>Each WPS processing task will be constructed as a Pod and invoked as a dedicated K8s Job. A Job creates one or more Pods to perform a given task. The Job object takes the responsibility of Pod failures. It makes sure that the given task is completed successfully. Once the task is over, all the Pods are terminated automatically.</p>
</div>
<div class="paragraph">
<p>Kubernetes provides Namespaces, which are an abstraction that supports multiple virtual clusters on the same physical cluster. It may be interesting to explore the use of K8s Namespaces for the purpose of establishing a sandboxed execution environment for each task execution.</p>
</div>
</div>
<div class="sect2">
<h3 id="procServiceDataAccess">5.6. Processing Service Data Access</h3>
<div class="paragraph">
<p>The Processing Framework (EMS/ADES) provides the environment through which processing services and workflows access input/output data. The EMS must ensure that the outputs of one step are marshalled to the next, and the ADES must prepare the inputs before job invocation, and collect the outputs at the job conclusion. The processing task is invoked as a Docker container. In doing so, the container execution environment must be provisioned with the input data for the task, and with the means to ‘export’ its outputs to the processing orchestration. Figure <a href="#img_procDataAccess">Figure 16</a> illustrates.</p>
</div>
<div id="img_procDataAccess" class="imageblock text-center">
<div class="content">
<img src="./images/processing-data-access.png" alt="processing data access" width="50%">
</div>
<div class="title">Figure 16. Processing Framework Data Access</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Data Input Sources</dt>
<dd>
<p>The data input sources may be the local exploitation platform, or output from a previous workflow step (local or other platform).</p>
</dd>
<dt class="hdlist1">Data Input Protocol</dt>
<dd>
<p>The data input protocol may be natively supported by the processing service - otherwise it will need to be staged-in by the Processing Framework.</p>
</dd>
<dt class="hdlist1">Data Stage-in</dt>
<dd>
<p>In order to stage-in the data, the Processing Framework must support the data access protocol through which the input data is provided, and it must know the capabilities of the processing service to be invoked. <strong>This represents a two-way contract between the Platform (on behalf of the Processing Framework) and the service/application being executed.</strong> Options for staging-in the data include local file-system access (e.g. via s3fs-fuse mount), or it may be more optimal for the service to access the data directly via HTTP-based interfaces, e.g. to exploit the efficiencies offered by cloud-optimised file formats.</p>
</dd>
<dt class="hdlist1">Data Stage-out</dt>
<dd>
<p>The ADES stages-out the results from the service/application.<br>
The EMS orchestrates the outputs to the next workflow step, or makes available the results to the end-user.</p>
</dd>
<dt class="hdlist1">Data Output Protocol</dt>
<dd>
<p>The data output protocol must be supported by the data destination. The retrieval of the output data is facilitated by use of simple approaches that can be encoded in an HTTP-base URL, such as HTTP GET/KVP or Object Store.</p>
</dd>
<dt class="hdlist1">Data Output Destination</dt>
<dd>
<p>The data output destination is either the EMS/next-process for a workflow, or the end-user receiving their results. The two-way Platform (Processing Framework) &lt;&#8594; Service/Application contract informs this data flow, with the workflow construction/orchestration taking into account the respective capabilities of the service/application and the platform in which it is being invoked.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The work carried out in the OGC Testbeds 13/14 relied upon use of mounted volumes within the processing task docker container. These mounted volumes present the input data, and receive the output data, as ‘local’ file system access from the point of view of the running container and the processor running within. Use of mounted volumes is equivalently supported by K8s, and is an approach that is relied upon for many (existing) applications that are capable only of accessing data through POSIX file-system interfaces.</p>
</div>
<div class="paragraph">
<p>Thus, for Mounted Volumes, the approach is to use standard container volumes that present as well-identified directories within the container. The input data is provided in a read-only input directory that mounts into the container hosting infrastructure. Similarly, an empty writable directory is presented for the processing to write is outputs, to be collected by the Processing Framework.</p>
</div>
<div class="paragraph">
<p>Nevertheless, we might envisage that access to the underlying data will be provided by the hosting platform through a variety of data access protocols, including: Object Store (S3/Swift), OGC (WMS, WMTS, WFS, WCS, WCPS), OPeNDAP, plus local file-system as mentioned above.</p>
</div>
<div class="paragraph">
<p>The processing framework must establish an environment in which the data access capabilities of the processing service are matched to the data access offering of the platform. There are two possibilities that need to be handled by the Processing Framework:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>The processing service / application natively supports the data access protocol, in which case there is no need to stage-in the data. Nevertheless, the Processing Framework must support the pass-through of input data as URL, and the reception of the output(s) as URL. This is facilitated by the utilisation of a <a href="#procDataAccessLib">Data Access Library</a> as described below. Also, it must be ensured that any outputs, e.g. to object store, are appropriately directed.</p>
</li>
<li>
<p>The processing service / application does not natively support the data access protocol(s) offered by the underlying platform storage, e.g. the processing service only supports local storage (mounted volume), in which case the Processing Framework must facilitate access to the data on behalf of the processing service.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>In cases where the processing service does not natively support the data access protocols offered by the underlying platform, the processing framework must facilitate access to platform data in a form that can be consumed by the processing service.</p>
</div>
<div class="paragraph">
<p>To support this, the service/application should declare the data access protocol that it requires. This declaration should be made in the Application Descriptor (ref. Application Package), and is selected from a standard set of protocols, including:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>AWS S3 Object Store</p>
</li>
<li>
<p>Swift Object Store (OpenStack)</p>
</li>
<li>
<p>OGC data access services:</p>
<div class="ulist">
<ul>
<li>
<p>Web Map Service (WMS)</p>
</li>
<li>
<p>Web Map Tile Service (WMTS)</p>
</li>
<li>
<p>Web Feature Service (WFS)</p>
</li>
<li>
<p>Web Coverage Service (WCS)</p>
</li>
<li>
<p>Web Coverage Processing Service (WCPS)</p>
</li>
</ul>
</div>
</li>
<li>
<p>OPeNDAP</p>
</li>
<li>
<p>Mounted Volume (local storage)</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Building upon the work of OGC Testbed-14 (ref. <a href="#TB14-AP">[TB14-AP]</a>), the Application Descriptor described in section <a href="#mainAppPackage">Application Packaging</a> can be enhanced to include additional application capabilities, as illustrated in <a href="#img_procAppDescriptorUpdated">Figure 17</a>.</p>
</div>
<div id="img_procAppDescriptorUpdated" class="imageblock text-center">
<div class="content">
<img src="./images/application-descriptor-updated.png" alt="application descriptor updated" width="70%">
</div>
<div class="title">Figure 17. Application Descriptor (Enhanced)</div>
</div>
<div class="paragraph">
<p>The Application Descriptor is enhanced with additional components:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Capabilities</strong><br>
Containing, for example, data access protocols supported, (implicitly 'local filesystem' for OGC Testbeds 13/14).</p>
</li>
<li>
<p><strong>Dependencies</strong><br>
Specifying, for example, required interfaces to a specific processing, such as dask/Spark etc.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong><em>The 'Platform Capabilities' are elaborated in section <a href="#platformCapabilities">Platform Capabilities</a>.</em></strong></p>
</div>
<div class="paragraph">
<p>The platform implementation must then ensure that the data interface is presented to the processing container in accordance with its descriptor. It is the job of the platform implementation to translate from the back-end data access protocol to that required by the container. There are a number of techniques that can be employed by the processing framework to facilitate this data access mediation:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Local File-system Stage-in/out</dt>
<dd>
<p>The processing framework must perform the data retrieval to stage-in the data for presentation through a mounted volume as local file-system access. At the conclusion of the processing the outputs must be marshalled into the appropriate platform storage for further consumption, e.g. push to object store.<br>
The approach can be facilitated by use of a FUSE file-system driver to achieve the mediation.</p>
</dd>
<dt class="hdlist1">Use of Filesystem in Userspace (FUSE)</dt>
<dd>
<p>Access to the back-end data storage (e.g. HTTP-based) is provided through a user-space driver that presents the remote data as if it were a local directory. For example, using s3fs-fuse (<a href="https://github.com/s3fs-fuse/s3fs-fuse" class="bare">https://github.com/s3fs-fuse/s3fs-fuse</a>), access to data in an S3 object store is provided through a FUSE mounted directory. Thus, from the perspective of the processing task, inputs (read) and outputs (write) are accessed through the local file-system interface – satisfying the constraints of the processor.</p>
</dd>
</dl>
</div>
<div id="procDataAccessLib" class="dlist">
<dl>
<dt class="hdlist1">Use of Data Access Library</dt>
<dd>
<p>A Data Access Library (DAL) provides an abstraction of the interface to the data. The library provides bindings for common languages (including python, Javascript) and presents a standard programmatic semantic for accessing the data from within the processing service codebase. Specific implementations of the DAL can be made to abstract the data access layer for a given Exploitation Platform. The Processing Framework must support the ability to 'plugin' an alternative implementation of the DAL at processor execution time.<br>
See section <a href="#mainDataAccessLib">Data Access Library</a>.</p>
</dd>
<dt class="hdlist1">Data Access Gateway</dt>
<dd>
<p>Access to the underlying platform data is provided through a common service layer that provides standard data access interfaces that are translated (gateway) to those of the underlying data tier.<br>
For example, to satisfy a processing service that requires an S3 interface, but is executed in an environment where the data is available through a POSIX file system. Minio (<a href="https://github.com/minio/minio" class="bare">https://github.com/minio/minio</a>) is an open source object store implementation that overlays an S3 interface over a POSIX file system.<br>
See section <a href="#mainDataAccessGateway">Data Access Gateway</a>.</p>
</dd>
</dl>
</div>
<div class="sect3">
<h4 id="_user_authorization_context">5.6.1. User Authorization Context</h4>
<div class="paragraph">
<p>The stage-in/out of data must operate within the context of the user’s ‘account’. Thus, the security context of the user must be passed through all aspects performed by the Processing Framework on behalf of the user. This is necessary to ensure that the user is only able to access data to which they are entitled and accounting &amp; billing considerations are properly maintained.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_wps_t_restjson">5.7. WPS-T REST/JSON</h3>
<div class="paragraph">
<p>This interface specification is used for both the Client &lt;&#8594; EMS, and the EMS &lt;&#8594; ADES interfaces.</p>
</div>
<div class="paragraph">
<p>WPS-T extends standard WPS by adding <em>DeployProcess</em> and <em>UndeployProcess</em> operations. Once a process has been deployed to a WPS then the existing <code>wps:Execute</code> operation remains applicable for execution in the standard way.</p>
</div>
<div class="paragraph">
<p>The following table is reproduced from <a href="#TB14-ADES">[TB14-ADES]</a>.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 42.4242%;">
<col style="width: 12.1212%;">
<col style="width: 30.303%;">
<col style="width: 15.1516%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Resource</th>
<th class="tableblock halign-left valign-top">HTTP Method</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">WPS operation</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The landing page provides links to the API definition, the Conformance statements and the metadata about the processes offered by this API</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve available processes</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Get<br>
Capabilities</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deploy a process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Deploy<br>
Process</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve a process description</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Describe<br>
Process</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Undeploy a process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Undeploy<br>
Process</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve the list of jobs for a process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/jobs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute a process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>Execute</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/jobs/{jobID}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve the status of a job</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>GetStatus</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/jobs/{jobID}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DELETE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dismiss a job</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/jobs/{jobID}/result</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve the result(s) of a job</p></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="paragraph">
<p>GetResult</p>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/quotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve the list of quotation ids for a given process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/quotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Request a quotation for a given process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/quotations/{quotationID}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve quotation information</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/quotations/{quotationID}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute a quoted process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/visibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve the visibility status for a process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/processes/{id}/visibility</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">PUT</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Change the visibility status for a process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/quotations</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve the list of all quotation ids</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/quotations/{quotationID}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve quotation information</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/quotations/{quotationID}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">POST</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Execute a quoted process</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/bills</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve the list of all bill identifiers</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/bills/{billID}</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Retrieve bill information</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">/conformance</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">GET</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">list all requirements classes specified in the standard (WPS REST/JSON Binding Core) that the server conforms to</p></td>
<td class="tableblock halign-left valign-top"><div class="content"></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_interactive_graphical_applications">5.8. Interactive (Graphical) Applications</h3>
<div class="paragraph">
<p>The work carried out in the OGC Testbeds focused on non-graphical applications, i.e. non-interactive processing functions executing algorithms without intervention. It is also noted that WPS does not facilitate the invocation of GUI-based interactive applications which offer a synchronous experience to the end-user.</p>
</div>
<div id="img_applicationsUseCase" class="imageblock text-center">
<div class="content">
<img src="./images/use-cases-applications.png" alt="use cases applications" width="100%">
</div>
<div class="title">Figure 18. Interactive Applications Use Case</div>
</div>
<div class="paragraph">
<p>That said, the approach to application packaging undertaken in the testbeds does lend itself to the packaging of GUI-based applications, which can be packaged, deployed and executed as docker containers, including:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Native applications</dt>
<dd>
<p>A remote desktop (RDP) approach is used to present the interface to the user, typically rendered through a web page presented in the user’s browser</p>
</dd>
<dt class="hdlist1">Web applications</dt>
<dd>
<p>The web application is delivered through the portal interface of the hosting exploitation platform.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In both cases, docker containers offer a good solution to package and deploy the application. At execution time it is necessary to ensure that the appropriate ports are exposed from the running container.</p>
</div>
<div class="paragraph">
<p>The Application Descriptor needs to be extended to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Introduce additional <code>deploymentProfileNames</code> and <code>executionUnit</code> types</p>
</li>
<li>
<p>Provide parameterisation to support the delivery of the GUI to the end-user</p>
</li>
<li>
<p>Ensure that data access is presented within the container in a way that is compatible with the GUI application (the mechanisms provided for non-interactive applications may be sufficient).</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_parallel_processing">5.9. Parallel Processing</h3>
<div class="paragraph">
<p>The OGC Testbeds 13/14 only consider serial processing jobs running in a single Docker container. Here we consider how this approach can be extended to accommodate job requiring parallelisation.</p>
</div>
<div class="paragraph">
<p>One possible approach, is to invoke the processing task as a docker container (as described above), but then within the implementation of this task it makes subordinate invocations that exploit some specific data processing clustering infrastructure available within the platform. For example, the invoked process executes some Python code that then invokes a dask or SLURM cluster to perform the processing work.</p>
</div>
<div class="paragraph">
<p>In this case, the processing task would have a dependency that the Exploitation Platform provides the required data processing technology. In order to resolve this capability dependency the following approach can be made:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The processing service declares within its Application Deployment Package, that it ‘requires’ a particular service</p>
</li>
<li>
<p>The Exploitation Platform declares within the capabilities document output from its WPS endpoint, that it ‘provides’ particular services</p>
</li>
<li>
<p>The EMS must ensure that the target EP provides the required service of the processing task to be invoked</p>
</li>
<li>
<p>The parameterisation for the ‘required’ service are passed to the processing task at invocation</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>A consistent vocabulary of services must be defined to unambiguously express the ‘required’ and ‘provides’ declarations.</p>
</div>
</div>
<div class="sect2">
<h3 id="_processor_development_environment_pde">5.10. Processor Development Environment (PDE)</h3>
<div class="paragraph">
<p>The Processor Development Environment provides a rich, interactive environment in which processing algorithms and services can be developed, tested, debugged and ultimately packaged so that they can be deployed to the platform and published via the marketplace.</p>
</div>
<div class="paragraph">
<p>The PDE supports the packaging of the user’s application in accordance with the Application Packaging format that is suitable for deployment at the EMS/ADES. It provides a sandboxed environment in which the user can test the deployment and execution of their packaged application, with access to suitable test data to perform the validation.</p>
</div>
<div class="paragraph">
<p>The PDE provides the tools for the developer to fully specify the metadata for their validated application and then add it as a tool in their workspace and/or publish it to the Resource Catalogue for wider consumption.</p>
</div>
</div>
<div class="sect2">
<h3 id="_interactive_analysis_tool">5.11. Interactive Analysis Tool</h3>
<div class="paragraph">
<p>The Interactive Analysis Tool presents a hosted coding environment through which expert users can interact directly with the data and services of the platform. It should provide support for a variety of coding languages, including those most popular in the community – Python, R, Julia, Javascript.</p>
</div>
<div class="paragraph">
<p>For example, the Interactive Analysis Tool can be provided as a Jupyter Notebook instance that is provisioned in the user’s context with a ‘platform integration’ layer that provides simple access to platform resources, including resources held within the user’s Workspace.</p>
</div>
<div class="paragraph">
<p>It must be integrated with the platforms authentication and authorization scheme in accordance with the IAM approach described by the User Management domain.</p>
</div>
<div class="paragraph">
<p>The Interactive Analysis Tool should support the user to save their interactive analysis sessions for future resumption and sharing with others for purposes of collaboration.</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mainResourceManagement">6. Resource Management</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The role of the Resource Management domain is the storage, discovery and access to resources in the Exploitation Platform. In this context, resources primarily refers to data and processing assets.</p>
</div>
<div class="paragraph">
<p>Storage is largely taken care of by the Resource Tier upon which the Exploitation Platform is hosted. The role of the Exploitation Platform is to ensure that the data can be accessed through common data access protocols based upon open standards.</p>
</div>
<div class="paragraph">
<p>This is important for:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the end-user wishing to access data directly, and accessing their results after processing</p>
</li>
<li>
<p>processing services accessing data for input/output</p>
</li>
<li>
<p>processing workflow steps accessing intermediate outputs from prior steps</p>
</li>
<li>
<p>other federated Exploitation Platforms accessing each other’s data and services through well understood interfaces</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To exploit the services of the Platform, users need to discover available resources and obtain detailed resource information. For example, a user&#8217;s data discovery workflow should include the ability to view collection/product information and visualise the data in the platform - this applies to data held within the platform, data added by end-users and data produced as the result of processing operations within the platform.</p>
</div>
<div id="img_resourceUseCase" class="imageblock text-center">
<div class="content">
<img src="./images/use-cases-resources.png" alt="use cases resources" width="100%">
</div>
<div class="title">Figure 19. Resource Management Use Case</div>
</div>
<div class="paragraph">
<p>Processing services and applications are also platform resources that are stored in artefact repositories and must be discoverable by users, including the information required by users to exploit the service. It is assumed that users will store their software artefacts in external public repositories such as DockerHub, GitHub, etc. In the future, it may be necessary for an Exploitation Platform to provide such repository services to its users. Discovery of processing services and applications is met though the provision of an <a href="#mainAppCatalogue">Application Catalogue</a>.</p>
</div>
<div class="paragraph">
<p>The inventory and presentation of resources to users must be organised in such a way as to facilitate the discovery and usage of resources in other federated Exploitation Platforms. For example, users must be able to discover data and services in other EPs in order to construct and execute workflows that span multiple federated EPs. <strong>Thus a Resource Catalogue provides the inventory of data, processing services, applications in such a way as to create a Marketplace for resource discovery, and provide a launchpad for their use within the exploitation platform</strong>.</p>
</div>
<div class="paragraph">
<p>Access to resources must be controlled according to the privileges afforded to the logged in user, and appropriate hooks must be established into the EPs accounting and billing subsystems. Thus, the Resource Management services must be implemented according to the approach defined by User Management for authorization, accounting and billing.</p>
</div>
<div class="paragraph">
<p>In addition to the resource holding of the underlying resource tier, the EP maintains a User Workspace in which each user is able to maintain specific data/services of interest to them, and also provides a place to hold results of processing operations. The User Workspace should be provided as a building block of the system that provides this personal inventory. Moreover, the concept can be extended to define Group Workspaces to create a place for sharing and collaboration.</p>
</div>
<div class="paragraph">
<p>A Data Ingestion component abstracts the interface to the underlying Resource Tier storage, ensures that incoming data is formatted in accordance with defined standards, is supported by appropriate metadata and directed towards the appropriate dataset collection.</p>
</div>
<div class="paragraph">
<p>The main components comprising the Resource Management domain are illustrated in <a href="#img_resourceOverview">Figure 20</a>:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Resource Catalogue</p>
</li>
<li>
<p>Data Access Services</p>
</li>
<li>
<p>Data Access Gateway</p>
</li>
<li>
<p>Data Access Library</p>
</li>
<li>
<p>Data Ingestion</p>
</li>
<li>
<p>Workspace</p>
</li>
</ul>
</div>
<div id="img_resourceOverview" class="imageblock text-center">
<div class="content">
<img src="./images/resource-overview.png" alt="resource overview" width="85%">
</div>
<div class="title">Figure 20. Resource Management Overview</div>
</div>
<div class="paragraph">
<p>To some degree, the role of these components is to provide an integration of the Exploitation Platform to the Resource Tier, by providing public services that bridge to the underlying data supply.</p>
</div>
<div class="sect2">
<h3 id="mainResourceCatalogue">6.1. Resource Catalogue</h3>
<div class="paragraph">
<p>The Catalogue provides the user the capability to discover resources, (including data/products/services/applications), by browse/search, and to obtain details on specific resources discovered. Resources of different type can be catalogued and delivered through the same service architecture and catalogue service interfaces - provided as a consolidated catalogue service, or through discrete services for each resource type. In each case the catalogue provides an inventory of resources that can be presented as a <em>Marketplace</em> for users to discover and browse.</p>
</div>
<div class="paragraph">
<p>Perhaps the most challenging aspect of this is that the Catalogues for both Data and Processing-Services must facilitate the proper construction of processing tasks, to ensure there is a correct match of the data types expected as input to the processing. This extends into the construction of workflows where the data types output by a processing task must match the supported inputs of the next task in the chain. The Catalogue must have a rich and consistent metadata model for both Data and Processing-Services in order to achieve these goals.</p>
</div>
<div class="sect3">
<h4 id="mainOpenSearch">6.1.1. CEOS OpenSearch Best Practise</h4>
<div class="paragraph">
<p>The Common Architecture advocates standardisation on the use of OpenSearch based-upon the CEOS OpenSearch Best Practise <a href="#CEOS-OS-BP">[CEOS-OS-BP]</a> which provides a blueprint for catalogue search and discovery. Within this context, the following OGC extensions and recommendations are applicable:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OpenSearch GEO: OpenSearch Geo and Time Extensions <a href="#OS-GEO-TIME">[OS-GEO-TIME]</a></p>
</li>
<li>
<p>OpenSearch EO: OGC OpenSearch Extension for Earth Observation <a href="#OS-EO">[OS-EO]</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In addition, the possibility to use the JSON-LD processing model might be considered (further analysis required) through application of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OGC EO Dataset Metadata GeoJSON(-LD) Encoding Standard <a href="#GEOJSON-LD">[GEOJSON-LD]</a></p>
</li>
<li>
<p>OGC OpenSearch-EO GeoJSON(-LD) Response Encoding Standard <a href="#GEOJSON-LD-RESP">[GEOJSON-LD-RESP]</a></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="mainAppCatalogue">6.1.2. Application Catalogue</h4>
<div class="paragraph">
<p>Processing services are published in an Application Catalogue that acts as a Marketplace and facilitates their discovery. Via the Marketplace users have a single point of access to all processing services that are published across the federated system. In order to invoke processing services and workflows, users must specify the data inputs and parameterisation. The metadata for each application record describes what data an application can be applied to, and how it can be chained in a workflow.</p>
</div>
<div class="paragraph">
<p>The Application Catalogue is the subject of the current OGC Testbed-15 EOPAD Thread, through which the Data Model and catalogue Service Interface are being explored. Thus, in addition to the best practise identified above, the outcomes of the TB15 EOPAD thread should be taken into consideration:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>OGC 17-084 (GeoJSON(-LD) metadata encoding for EO collections) <a href="#GEOJSON-LD">[GEOJSON-LD]</a></strong><br>
Explore the capabilities of OGC 17-084 to encode application metadata</p>
</li>
<li>
<p><strong>OGC 17-047 (OGC OpenSearch-EO GeoJSON(-LD) Response Encoding Standard) <a href="#GEOJSON-LD-RESP">[GEOJSON-LD-RESP]</a></strong><br>
Explore the capabilities of OGC 17-047 to encode OpenSearch responses in GeoJSON(-LD)<br>
Use of multi-step discovery and faceted search</p>
</li>
<li>
<p><strong>Registration</strong><br>
Explore transactional extension to OGC-CSW for application registration.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is anticipated that the outcome of the OGC Testbed-15 (EOPAD) will further inform the design of the Application Catalogue.</p>
</div>
</div>
<div class="sect3">
<h4 id="mainDataCatalogue">6.1.3. Data Catalogue</h4>
<div class="paragraph">
<p>The Catalogue provides the user the capability to discover data/products by browse/search, and to obtain details on specific data/products discovered. The Marketplace concept can be extended to embrace the discovery and access to data.</p>
</div>
<div class="sect4">
<h5 id="_metadata_organisation">6.1.3.1. Metadata Organisation</h5>
<div class="paragraph">
<p>The data is organised into Collections, typically representing a dataset. Each collection is composed of multiple granules as files. The catalogue metadata follows a similar organisation and allows the user to discover the data in natural sympathy with this data organisation. Hence, the metadata is presented at the following levels:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Browse Metadata (collection)</dt>
<dd>
<p>Browse metadata is defined at the collection/dataset level. It typically uses ISO19115 records to describe the high-level collection information, such as title, description, spatial/temporal coverage, list of variables available, access rights, T&amp;Cs, etc.<br>
(For collections, the spatial coverage is often full-earth).</p>
</dd>
<dt class="hdlist1">Discovery Metadata (product)</dt>
<dd>
<p>Discovery metadata is defined for each granule (file) comprising the collection. This typically includes information such as file-type(s), spatial/temporal coverage, variable, data access (download) method(s). Much of this information can be obtained from the headers of the individual files – depending on file-type. Thus, the Discovery metadata can in-part be populated automatically from the underlying files.</p>
</dd>
<dt class="hdlist1">Archive Metadata (file)</dt>
<dd>
<p>Archive metadata refers to the information that is available in the file header. As described above this can be extracted and published into the Discovery metadata of the catalogue.</p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_example_usage_with_opensearch">6.1.3.2. Example Usage with OpenSearch</h5>
<div class="paragraph">
<p>This metadata model can be exploited, for example, using OpenSearch:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Initial search is made at the collection level to discover collections/dataset of interest.</p>
</li>
<li>
<p>Subsequent OpenSearch requests can then be made to drill-down into a specific collection to discover and obtain details regarding the granules.</p>
</li>
<li>
<p>Once discovered, the granules can then be exploited by the user, for example as input to a processing request, or downloaded.</p>
</li>
<li>
<p>Facets can be applied to both the Browse and Discovery metadata, to supported facetted search at both levels.</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_data_access">6.1.3.3. Data Access</h5>
<div class="paragraph">
<p>There is a direct link between the way the data is described in the Catalogue and how it is accessed by the consumers of the data. This links to the Data Access Services (e.g. WMS. WCS, WFS, etc.) provided by the EP, and the way in which the access links are encoded into the Catalogue. These links must be usable by the data consumers which could be processing services, or users downloading the data.</p>
</div>
<div class="paragraph">
<p>Hence the contents of the Catalogue reflects the data services offered by the platform, including the underlying resource tier services. Each data Collection is presented in the Catalogue as accessible through one or more data access services, as applicable to the specific data. The Catalogue must present the data access URLs in such a way that the URL resolves correctly to the underlying data via the providing data access service.</p>
</div>
</div>
<div class="sect4">
<h5 id="_catalogue_compositionaggregation">6.1.3.4. Catalogue Composition/Aggregation</h5>
<div class="paragraph">
<p>The Exploitation Platform is designed to be hosted in a compute environment that is close to the data of interest. This means that the typical deployment is made to the likes of DIAS, Public Cloud (such as AWS), or National Research Infrastructure (such as CEDA/JASMIN) – that provide the Resources-tier/infrastructure upon which the EP relies. The Resources-tier provides virtual ICT-infrastructure and data. It is common that the Resources-tier provides their own Catalogue to support the data hosted within.</p>
</div>
<div class="paragraph">
<p>In order to ensure a coherent link between data discovery and access, the Exploitation Platform provides its own Catalogue that presents the data holding to be accessed through the available data access services. In doing so it must aggregate the catalogue records of the underlying resource tier, the records of other 'federated' platforms, and the value-added data that is contributed through the actions of users on the EP. Thus the EP provides a Catalogue that is tailored to its service offering to ensure a consistent data access interface that can be relied upon by other EP services, in particular by the executing user analysis functions running within the Processing &amp; Chaining context.</p>
</div>
<div id="img_catalogueAggregation" class="imageblock text-center">
<div class="content">
<img src="./images/catalogue-aggregation.png" alt="catalogue aggregation" width="100%">
</div>
<div class="title">Figure 21. Catalogue Aggregation</div>
</div>
<div class="paragraph">
<p>We wish the exploitation platform to expose a public catalogue that provides both the Browse (collection) and Discovery (product) views:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>In the case where the Resource-tier provides these in a way that is conformant with the architecture then these can be relied upon directly for the exploitation platform</p>
</li>
<li>
<p>In the case where the Resource-tier provides only a suitable Product catalogue, then the Collection catalogue must be provided by the EP, with the granule queries being directed to the back-end catalogue. Alternatively, this could be achieved by harvesting the Resource-tier product catalogue into the EP catalogue.</p>
</li>
<li>
<p>Alternatively, the EP may provide a Catalogue-shim to ensure that an existing Resource-tier catalogue conforms to the interface demands of the open architecture</p>
</li>
<li>
<p>Otherwise, the EP must provide all catalogue aspects.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The important point is to ensure that the EP presents interfaces that conform to its defined open standards, and is able to take measures to ensure this is the case. From the perspective of the user of the Exploitation Platform a single Data Catalogue end-point is most desirable. The EP web interface can present a consolidated user view in the case of multiple catalogue end-points. A similar consolidation approach can be applied by the EP programmatic API, which can present a single end-point on behalf of the back-end data catalogues.</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_federated_discovery">6.1.4. Federated Discovery</h4>
<div class="paragraph">
<p>In order that a user is able to discover data/services of interest in a federated network of Exploitation Platforms, an approach to Catalogue federation must be established between collaborating platforms.</p>
</div>
<div id="img_catalogueFederation" class="imageblock text-center">
<div class="content">
<img src="./images/catalogue-federation.png" alt="catalogue federation" width="70%">
</div>
<div class="title">Figure 22. Catalogue Federation</div>
</div>
<div class="paragraph">
<p>As illustrated in <a href="#img_catalogueFederation">Figure 22</a> there are a number of possible approaches:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Gateway – A central proxy</p>
</li>
<li>
<p>Centralised – Central mirror</p>
</li>
<li>
<p>Distributed - Catalogues mirror each other</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Further analysis is required to understand these options, their applicability and impact on the Common Architecture.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_data_access_services">6.2. Data Access Services</h3>
<div class="paragraph">
<p>The Exploitation Platform provides access to data through public services based upon Open Standards, for the consumption by end-users and other federated platforms.</p>
</div>
<div class="paragraph">
<p>The primary services provided by an Exploitation Platform should include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>OGC Web Map Service (WMS)</p>
</li>
<li>
<p>OGC Web Map Tile Service (WMTS)</p>
</li>
<li>
<p>OGC Web Feature Service (WFS)</p>
</li>
<li>
<p>OGC Web Coverage Service (WCS)</p>
</li>
<li>
<p>OGC Web Coverage Processing Service (WCPS)</p>
</li>
<li>
<p>Services provided by Resource Tier:</p>
<div class="ulist">
<ul>
<li>
<p>AWS S3 Object Store</p>
</li>
<li>
<p>Swift Object Store (OpenStack)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Other services that may also be considered include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>WebDAV</p>
</li>
<li>
<p>FTP</p>
</li>
<li>
<p>CDMI</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Integration of these data access services with the data-layer of the hosting Resource Tier relies upon the Data Access Gateway providing an infrastructure agnostic interface for accessing the underlying data holding.</p>
</div>
</div>
<div class="sect2">
<h3 id="mainDataAccessGateway">6.3. Data Access Gateway</h3>
<div class="paragraph">
<p>The EO datasets are stored according to the underlying storage technology of the infrastructure Resource Tier. The storage interface presented is not under the control of the Exploitation Platform.</p>
</div>
<div class="paragraph">
<p>The role of the Data Access Gateway is to provide an abstraction layer on top of the underlying storage to present a well-defined storage interface to the other components of the Exploitation Platform.</p>
</div>
<div class="paragraph">
<p>The main EP components that require data access are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Processing services and applications: stage-in/out of data/results</p>
</li>
<li>
<p>Platform Data Access Services (WMS,WCS,etc.): access to datasets</p>
</li>
<li>
<p>Ingestion: storage of ingested data</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the EP system design, these services are designed to be deployed as containers through Kubernetes. This presents the possibility that some aspects of the Data Access Gateway can be met by the facilities offered by Kubernetes volumes. Access to underlying data is provided through volumes that are mounted into the container. Kubernetes volumes have native support for a number of common storage technologies (such as AWS EBS, Cinder), however these tend to be block rather than object storage.</p>
</div>
<div class="paragraph">
<p>The Gateway must provide a data bridge between the EP components and the Resource Tier. It fills the gap in the data access capabilities of a given a given service/application, and provides a common data access interface that such components can target in their implementation. We might regard the lowest-common-denominator for data access to be a combination of:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Local filesystem access</p>
</li>
<li>
<p>AWS S3 Object Store</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Through docker/kubernetes we can use mounted 'volumes' to present data through a local filesystem interface.<br>
Through s3fs-fuse we can establish local filesystem mount points to S3 object stores.<br>
The Processing Framework makes use of these capabilities to ensure that data is presented to processing services/applications in a form that they can consume.</p>
</div>
<div class="paragraph">
<p>Thus, the Data Access Gateway presents an S3 interface as an internal data access abstraction, whilst implementing the data access interface to the infrastructure Resource Tier storage.</p>
</div>
</div>
<div class="sect2">
<h3 id="mainDataAccessLib">6.4. Data Access Library (DAL)</h3>
<div class="paragraph">
<p>In addition to the Data Access Gateway, which operates as an internal service, the Data Access Library (DAL) is provided specifically as a point of integration for processing services and applications. The Data Access Library provides an abstraction of the interface to the data, with bindings for common languages (including python. R, Javascript) and presents a standard programmatic semantic for accessing the data from within the processing service codebase.</p>
</div>
<div class="paragraph">
<p><strong><em>The Data Access Library can be seen as a subset of the facilities offered by the <a href="#mainClientLibrary">Client Library</a>.</em></strong></p>
</div>
<div class="paragraph">
<p>The Data Access Library can provide an abstraction at two levels:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Protocol abstraction</dt>
<dd>
<p>Standard programmatic semantics are provided for accessing the data (i.e. CRUD operations on data granules), that is agnostic of the underlying platform storage data access protocols. This is a lower level interface that should be applicable to all use cases.</p>
</dd>
<dt class="hdlist1">Data Model abstraction</dt>
<dd>
<p>A common object model is defined with programmatic semantics, which provides a higher-level abstraction of the data that hides the details of the underlying storage, files and file-formats. The abstraction accesses and parses the underlying data to present data structure representations within the language bindings. Such an object model would likely be applicable to some, but not all, use cases. In cases where this approach is not applicable, then protocol abstraction provides the fall-back option.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Thus, processing services and applications can be implemented in a ‘portable’ way that is agnostic to the platform resource-tier storage technology.</p>
</div>
<div class="paragraph">
<p>Specific implementations of the DAL can be made to abstract the data access layer for a given Exploitation Platform. The library offered to the processing service at runtime must implement the specific data access interface to the resource-tier storage. Hence, the library should not be ‘hard-coded’ into the processor application package (Docker image). The Processing Framework must support the ability to 'plugin' an alternative (platform-specific) implementation of the DAL dynamically at processor execution time. It may be possible to develop a 'generic' Data Access Library by implementation against the standard (internal) interface provided by the Data Access Gateway. In this case, the platform-specifics regarding data access are borne entirely by the Data Access Gateway.</p>
</div>
<div class="paragraph">
<p><strong>See also section <a href="#procServiceDataAccess">Processing Service Data Access</a> which provides a discussion of data access approaches for processing services and the stage-in/out of data.</strong></p>
</div>
</div>
<div class="sect2">
<h3 id="_data_ingestion">6.5. Data Ingestion</h3>
<div class="paragraph">
<p>Data Ingestion presents a standard interface to the EP components, whilst transparently interfacing with the infrastructure Resource Tier.</p>
</div>
<div class="paragraph">
<p>During data ingestion the following steps may be performed:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Authorization check</p>
</li>
<li>
<p>Quota check</p>
</li>
<li>
<p>Metadata extraction</p>
</li>
<li>
<p>Preview generation</p>
</li>
<li>
<p>Format conversion</p>
</li>
<li>
<p>Storage PUT</p>
</li>
<li>
<p>Catalogue PUT</p>
</li>
<li>
<p>Trigger notifications</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Ingestion raises notifications for the following events:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Raise indicators to users (visual, emails, etc.)</p>
</li>
<li>
<p>Trigger systematic actions in other EP services (e.g. systematic processing)</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="mainWorkspace">6.6. Workspace</h3>
<div class="paragraph">
<p>The Workspace provides a service to users through which they can organise data/processing-services that are of current interest to them, they are currently working on, and to organise results of processing executed, Research Objects, etc.</p>
</div>
<div class="paragraph">
<p>This concept can be extended to create a Group Workspace for sharing and collaboration.</p>
</div>
<div class="paragraph">
<p>It may be possible to model the Workspace as a Catalogue, in which the browse/discover access privilege is limited to either an individual user (personal workspace) or a group of collaborating users (group workspace):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>READ access: OpenSearch should provide a good fit for this interface</p>
</li>
<li>
<p>CREATE/UPDATE/DELETE: Transactional extension to OGC-CSW (to be explored)</p>
</li>
</ul>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mainPlatformApi">7. Platform API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Platform API defines standard interfaces at both service and programmatic levels, with the goal of encouraging interoperation between platforms and providing a consistent and portable programming paradigm for expert users. The Service API and its associated Client Library together present a standard platform interface against which analysis and exploitation activities may be developed, and through which platform services can be federated.</p>
</div>
<div class="paragraph">
<p>The Service API represents the public service interfaces exposed by the Exploitation Platform for consumption by its clients. Covering all aspects of the EP (authentication, data/processing discovery, processing etc.), these interfaces are based upon open standards and are designed to offer a consistent EP service access semantic within the network of EO resources. Use of the network (HTTP) interfaces of the Service API is facilitated by the Client Library that provides bindings for common languages (Python, R, Javascript). The Client Library is a programmatic representation of the Service API which acts as an abstraction of the Exploitation Platform and so facilitates the development of portable client implementations.</p>
</div>
<div id="img_clientPortability" class="imageblock text-center">
<div class="content">
<img src="./images/client-portability.png" alt="client portability" width="100%">
</div>
<div class="title">Figure 23. Client Portability</div>
</div>
<div class="paragraph">
<p>As illustrated in <a href="#img_clientPortability">Figure 23</a>, code implemented against the Client Library is not tied to a particular Exploitation Platform, but instead can be initialised and executed against any EP that supports the corresponding Service API. The User Service/Application shown in the figure can either be a process running external to the platform (e.g. on the users local platform), or running as a deployed process within the Processing Framework of the platform. <strong>It should be noted that the use of the Client Library is not mandatory - instead the application can be developed against the Service API directly.</strong></p>
</div>
<div class="sect2">
<h3 id="mainServiceApi">7.1. Service API</h3>
<div class="paragraph">
<p>The Service API presented by the Exploitation Platform is largely defined and met by the fundamental data/processing services it offers. There are some additional meta-services that support the clients in the discovery and usage of these core services. The Service API defined in this section seeks to define a standard set of interfaces against which the Client Library can be developed and that can be relied upon for platform-to-platform interoperability.</p>
</div>
<div class="sect3">
<h4 id="platformCapabilities">7.1.1. Platform Capabilities</h4>
<div class="paragraph">
<p>Provides a single well-known 'bootstrap' URL through which the service capabilities and their endpoints can be discovered:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Declare platform capabilities</p>
</li>
<li>
<p>Discover service endpoints</p>
</li>
<li>
<p>Core platform data/processing services</p>
</li>
<li>
<p>Additional meta-services to support clients</p>
</li>
<li>
<p>Used by <a href="#mainClientLibrary">Client Library</a> to initialise its platform interfaces</p>
</li>
<li>
<p>Used by <a href="#mainProcEMS">EMS</a> to match service/application dependencies with platform capabilities</p>
</li>
<li>
<p>Used by other platforms to establish interoperability</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><strong>/.well-known/eoepca-platform</strong></p>
</div>
<div class="listingblock">
<div class="title">Example Platform Capabilities</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="json">{
    <span class="key"><span class="delimiter">&quot;</span><span class="content">services</span><span class="delimiter">&quot;</span></span>: [
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">oidc</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">authentication</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/connect</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tbd&gt;</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">billing</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/billing</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">opensearch</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">data_search</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/search</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">csw</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">data_catalogue</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/catalogue</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">opensearch</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">app_search</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/applications</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">wms</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">map</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/map</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">wmts</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">tile</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/tile</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">wfs</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">feature</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/feature</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">wcs</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">coverage</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/coverage</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">wcps</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">datacube</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/datacube</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">s3</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">object_store</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/storage</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">wps-t</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ems</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/ems</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">wps-t</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">ades</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/ades</span><span class="delimiter">&quot;</span></span> },
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;tbd&gt;</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">workspace</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">path</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">/workspace</span><span class="delimiter">&quot;</span></span> },
    ],
    <span class="key"><span class="delimiter">&quot;</span><span class="content">extended_capabilities</span><span class="delimiter">&quot;</span></span>: [
        { <span class="key"><span class="delimiter">&quot;</span><span class="content">type</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">dask</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">role</span><span class="delimiter">&quot;</span></span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">cluster</span><span class="delimiter">&quot;</span></span>, <span class="key"><span class="delimiter">&quot;</span><span class="content">details</span><span class="delimiter">&quot;</span></span>: {} },
    ]
}</code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>The endpoints referenced in eoepca-platform are described in the following sections.</strong></p>
</div>
</div>
<div class="sect3">
<h4 id="_authentication">7.1.2. authentication</h4>
<div class="paragraph">
<p>The URL of the OpenID Connect Provider that implements the <a href="#mainLoginService">Login Service</a> for user authentication.</p>
</div>
<div class="paragraph">
<p><strong>/connect</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements the OpenID Connect protocol as described in <a href="#OIDC">[OIDC]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_billing">7.1.3. billing</h4>
<div class="paragraph">
<p>The URL of the endpoint of the Billing service in the platform.</p>
</div>
<div class="paragraph">
<p><strong>/billing</strong> (example)</p>
</div>
<div class="paragraph">
<p>The Billing service provides a cenrtralised point of contact within the platform responsible for tracking and billing for usage of resources and services. The approach to billing is currently not defined, but will be documented in section <a href="#mainBilling">Accounting and Billing</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_search">7.1.4. data_search</h4>
<div class="paragraph">
<p>The URL of the OpenSearch interface to the <a href="#mainDataCatalogue">Data Catalogue</a>.</p>
</div>
<div class="paragraph">
<p><strong>/search</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OpenSearch interface in accordance with section <a href="#mainResourceCatalogue">Resource Catalogue</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_data_catalogue">7.1.5. data_catalogue</h4>
<div class="paragraph">
<p>The URL of the OGC CSW (Catalogue Services for the Web) interface to the <a href="#mainDataCatalogue">Data Catalogue</a>.</p>
</div>
<div class="paragraph">
<p><strong>/catalogue</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OGC CSW catalogue in accordance with standard <strong>OGC Catalogue Services 3.0 Specification - HTTP Protocol Binding</strong> as defined in <a href="#OGC-CSW">[OGC-CSW]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_app_search">7.1.6. app_search</h4>
<div class="paragraph">
<p>The URL of the OpenSearch interface to the <a href="#mainAppCatalogue">Application Catalogue</a>.</p>
</div>
<div class="paragraph">
<p><strong>/applications</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OpenSearch interface in accordance with section <a href="#mainAppCatalogue">Application Catalogue</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_map">7.1.7. map</h4>
<div class="paragraph">
<p>The URL of the OGC WMS (Web Map Service) interface that supports the data maintained in the <a href="#mainDataCatalogue">Data Catalogue</a>.</p>
</div>
<div class="paragraph">
<p><strong>/map</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OGC WMS service in accordance with standard <strong>OGC Web Map Server Implementation Specification</strong> as defined in <a href="#OGC-WMS">[OGC-WMS]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_tile">7.1.8. tile</h4>
<div class="paragraph">
<p>The URL of the OGC WMTS (Web Map Tile Service) interface that supports the data maintained in the <a href="#mainDataCatalogue">Data Catalogue</a>.</p>
</div>
<div class="paragraph">
<p><strong>/tile</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OGC WMTS service in accordance with standard <strong>OGC Web Map Tile Service Implementation Standard</strong> as defined in <a href="#OGC-WMTS">[OGC-WMTS]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_feature">7.1.9. feature</h4>
<div class="paragraph">
<p>The URL of the OGC WFS (Web Feature Service) interface that provides a <em>Feature-oriented</em> access to the underlying data holding of the platform.</p>
</div>
<div class="paragraph">
<p><strong>/feature</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OGC WFS service in accordance with standard <strong>OGC Web Feature Service 2.0 Interface Standard – With Corrigendum</strong> as defined in <a href="#OGC-WFS">[OGC-WFS]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_coverage">7.1.10. coverage</h4>
<div class="paragraph">
<p>The URL of the OGC WCS (Web Coverage Service) interface that provides a <em>Coverage-oriented</em> access to the underlying data holding of the platform.</p>
</div>
<div class="paragraph">
<p><strong>/coverage</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OGC WCS service in accordance with standard <strong>OGC Web Coverage Service (WCS) 2.1 Interface Standard - Core</strong> as defined in <a href="#OGC-WCS">[OGC-WCS]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_datacube">7.1.11. datacube</h4>
<div class="paragraph">
<p>The URL of the OGC WCPS (Web Coverage Processing Service) interface that provides a queryable 'data cube' interface to multi-dimensional coverage data.</p>
</div>
<div class="paragraph">
<p><strong>/datacube</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an OGC WCPS service in accordance with standard <strong>Web Coverage Processing Service (WCPS) Language Interface Standard</strong> as defined in <a href="#OGC-WCPS">[OGC-WCPS]</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_object_store">7.1.12. object_store</h4>
<div class="paragraph">
<p>The URL of the <em>Amazon S3</em> interface that provides object storage access to the underlying data holding of the platform.</p>
</div>
<div class="paragraph">
<p><strong>/object_store</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an Amazon S3 service in accordance with <strong>Amazon Simple Storage Service REST API</strong> as defined in <a href="#AWS-S3">[AWS-S3]</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">Amazon S3 Compatibility Subset</div>
<div class="paragraph">
<p>For the purposes of this interface, a subset of the full Amazon S3 REST API will be defined as mandatory. The motivation is to define a consistent interface that is supported by third-party object storage implementations that provide an S3-compatible API, such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Ceph (<a href="https://ceph.com/ceph-storage/" class="bare">https://ceph.com/ceph-storage/</a>)</p>
<div class="ulist">
<ul>
<li>
<p>CEPH OBJECT GATEWAY S3 API (<a href="http://docs.ceph.com/docs/mimic/radosgw/s3/" class="bare">http://docs.ceph.com/docs/mimic/radosgw/s3/</a>)</p>
</li>
</ul>
</div>
</li>
<li>
<p>OpenStack Swift (<a href="https://docs.openstack.org/swift" class="bare">https://docs.openstack.org/swift</a>)</p>
<div class="ulist">
<ul>
<li>
<p>S3/Swift REST API Comparison Matrix (<a href="https://docs.openstack.org/swift/latest/s3_compat.html" class="bare">https://docs.openstack.org/swift/latest/s3_compat.html</a>)</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_ems">7.1.13. ems</h4>
<div class="paragraph">
<p>The URL of the <a href="#mainProcEMS">Execution Management Service</a> service.</p>
</div>
<div class="paragraph">
<p><strong>/ems</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an <strong>EMS service</strong> as described in section <a href="#mainProcEMS">Execution Management Service</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ades">7.1.14. ades</h4>
<div class="paragraph">
<p>The URL of the <a href="#mainProcADES">Application Deployment and Execution Service</a> service.</p>
</div>
<div class="paragraph">
<p><strong>/ades</strong> (example)</p>
</div>
<div class="paragraph">
<p>Implements an <strong>ADES service</strong> as described in section <a href="#mainProcADES">Application Deployment and Execution Service</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_workspace">7.1.15. workspace</h4>
<div class="paragraph">
<p>The URL of the 'user workspace' service as described in section <a href="#mainWorkspace">Workspace</a>.</p>
</div>
<div class="paragraph">
<p><strong>/workspace</strong> (example)</p>
</div>
<div class="paragraph">
<p>The interface for the workspace is currently <mark>TBD</mark>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="mainClientLibrary">7.2. Client Library</h3>
<div class="paragraph">
<p>The Service API and its associated Client Library together present a standard platform interface against which analysis and exploitation activities may be developed, and through which platform services can be federated.</p>
</div>
<div class="paragraph">
<p>The Client Library is a programmatic representation of the Service API which acts as an abstraction of the Exploitation Platform and so facilitates the development of portable client implementations.</p>
</div>
<div id="img_clientLibServiceInterfaces" class="imageblock text-center">
<div class="content">
<img src="./images/client-lib-service-interfaces.png" alt="client lib service interfaces" width="100%">
</div>
<div class="title">Figure 24. Client Library Service Interfaces</div>
</div>
<div class="paragraph">
<p>As illustrated in <a href="#img_clientLibServiceInterfaces">Figure 24</a>, the Client Library provides bindings for common languages (Python, R, Javascript) that utilise the network (HTTP) interfaces of the Service API, covering all aspects of the Exploitation Platform functionality (authentication, data/processing discovery, processing etc.).</p>
</div>
<div class="sect3">
<h4 id="_client_library_concept_illustration">7.2.1. Client Library Concept Illustration</h4>
<div class="paragraph">
<p>The design of the Client Library is not yet established. To illustrate its concept we present an example based upon the workflow scenario that was used to demonstrate the EMS/ADES best practice in OGC Testbed-14 (<a href="#TB14-ADES">[TB14-ADES]</a>). The scenario is shown in <a href="#img_ndviStacker">Figure 25</a>.</p>
</div>
<div id="img_ndviStacker" class="imageblock text-center">
<div class="content">
<img src="./images/ndvi-stacker.png" alt="ndvi stacker" width="80%">
</div>
<div class="title">Figure 25. OGC Testbed-14 Workflow Scenario (NDVI Stacker)</div>
</div>
<div class="paragraph">
<p>Four platforms are involved in the scenario:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Platforms A/B/C</dt>
<dd>
<p>These platforms perform the local execution (ADES) of the MultiSensorNDVI processor on a collection in their local data holding. These executions are managed under the orchestration (EMS) of the Primary Platform.</p>
</dd>
<dt class="hdlist1">Primary Platform</dt>
<dd>
<p>The Primary Platform is in charge of the workflow. Thus, the orchestration (EMS) is conducted from this platform, which interfaces to the 'subordinate' platforms (A/B/C) for the execution of the steps 'close-to-the-data', and then completes the workflow by execution (ADES) of the NDVIStacker processor to produce the final result.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>In response to this scenario we might envisage a client application implemented against the Client Library as follows&#8230;&#8203;</p>
</div>
<div class="listingblock">
<div class="title">Example python program using Client Library</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="python"><span class="keyword">import</span> <span class="include">eoepca</span>

<span class="comment"># Connect to primary platform - e.g. when running on own desktop</span>
primaryPlatform = eoepca.platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://primary.platform.eo</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="1"></i><b>(1)</b>
primaryPlatform = primaryPlatform.authenticate(<span class="string"><span class="delimiter">&quot;</span><span class="content">bob@home.org</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;&lt;MY-API-KEY&gt;&gt;</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="2"></i><b>(2)</b>
<span class="comment"># Or, use the 'local' hosting platform - e.g. when running in 'cloud' platform</span>
primaryPlatform = eoepca.platform().authenticate(<span class="string"><span class="delimiter">&quot;</span><span class="content">bob@home.org</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;&lt;MY-API-KEY&gt;&gt;</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="2"></i><b>(2)</b> <i class="conum" data-value="3"></i><b>(3)</b>

<span class="comment"># Init supporting platforms</span>
platA = eoepca.platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://platform-a.eo</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="4"></i><b>(4)</b>
platB = eoepca.platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://platform-b.eo</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="4"></i><b>(4)</b>
platC = eoepca.platform(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://platform-c.eo</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="1"></i><b>(1)</b> <i class="conum" data-value="4"></i><b>(4)</b>

<span class="comment"># Specify extent</span>
extent = { <span class="string"><span class="delimiter">&quot;</span><span class="content">bbox</span><span class="delimiter">&quot;</span></span>: [ -<span class="float">0.489</span>, <span class="float">51.28</span>, <span class="float">0.236</span>, <span class="float">51.686</span> ], <span class="string"><span class="delimiter">&quot;</span><span class="content">time</span><span class="delimiter">&quot;</span></span>: [ <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-01-01</span><span class="delimiter">&quot;</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">2018-12-31</span><span class="delimiter">&quot;</span></span> ] }

<span class="comment"># Specify processes</span>
coverage1 = platA.collection(<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAT_A_DATA</span><span class="delimiter">&quot;</span></span>).coverage(extent) <i class="conum" data-value="5"></i><b>(5)</b>
proc1 = coverage1.process(<span class="string"><span class="delimiter">&quot;</span><span class="content">MultiSensorNDVI</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="6"></i><b>(6)</b>
proc2 = platB.collection(<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAT_B_DATA</span><span class="delimiter">&quot;</span></span>).coverage(extent).process(<span class="string"><span class="delimiter">&quot;</span><span class="content">MultiSensorNDVI</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="5"></i><b>(5)</b> <i class="conum" data-value="6"></i><b>(6)</b>
proc3 = platC.collection(<span class="string"><span class="delimiter">&quot;</span><span class="content">PLAT_C_DATA</span><span class="delimiter">&quot;</span></span>).coverage(extent).process(<span class="string"><span class="delimiter">&quot;</span><span class="content">MultiSensorNDVI</span><span class="delimiter">&quot;</span></span>)  <i class="conum" data-value="5"></i><b>(5)</b> <i class="conum" data-value="6"></i><b>(6)</b>

<span class="comment"># Specify workflow</span>
workflow = primaryPlatform.parallel([proc1, proc2, proc3]).process(<span class="string"><span class="delimiter">&quot;</span><span class="content">NDVIStacker</span><span class="delimiter">&quot;</span></span>) <i class="conum" data-value="7"></i><b>(7)</b>

<span class="comment"># Get result - initiates 'lazy' execution</span>
result = workflow.retrieve(format=<span class="string"><span class="delimiter">&quot;</span><span class="content">geotiff</span><span class="delimiter">&quot;</span></span>, options={}) <i class="conum" data-value="8"></i><b>(8)</b>
print(result)</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>When each platform object is initialised, its endpoint <a href="#platformCapabilities"><code>${platform-url}/.well-known/eoepca-platform</code></a> is interrogated, to understand its capabilities and learn its service endpoints.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>The user must authenticate to the primary platform (that 'executes' the workflow), using their API key.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>In the case where the client is <strong>running on the primary platform</strong> then the platform URL is not required in the initialisation (implying 'local' platform). Examples of this case include: code running in a hosted Jupyter notebook, or a deployed processing service that chooses to use the Client Library.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Subordinate platforms are initialised (for capabilities) without authentication, on the basis that the primary platform authentication can be carried through the workflow 'call-stack' through delegated/federated IAM solution - ref. section <a href="#IAM">Identity and Access Management</a>.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>At each platform the collection is selected through its unique collection identifier, and a data coverage subset is specified through a definition of the required spatial/temporal extent.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>At each platform the processing task to be exectued against the selected coverage is specified.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>The workflow is defined by requesting the parallel execution of the <code>MultiSensorNDVI</code> processor on each of the three platforms, with these results providing input to the <code>NDVIStacker</code> process executed on the primary platform.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>The call to <code>retrieve</code> the outcome of the workflow initiates its <strong>'lazy' execution</strong>. Prior to this point the Client Library has been operating on <strong>'proxy'</strong> objects that record the <strong>specification of the workflow</strong> requested by the code. At this point the Client Library converts the workflow specification into a CWL definition suitable for deployment and execution at the <a href="#mainProcEMS">EMS</a> of the primary platform. In response the EMS will interface with the <a href="#mainProcADES">ADES</a> of each subordinate platform to ensure the <code>MultiSensorNDVI</code> is deployed and executed against the requested coverage. Subsequently the EMS interfaces with the ADES of the local platform to ensure the <code>NDVIStacker</code> is deployed and executed against the outputs of the three <code>MultiSensorNDVI</code> process executions.</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="mainWebPortal">8. Web Portal</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Web Portal represents the browser-based user interface through which the user interacts with the EO Exploitation Platform.</p>
</div>
<div class="paragraph">
<p>The Web Portal is not a domain area in its own right – it is contributed to by the collaborative developments of the defined domain areas. The user’s view of the platform is consolidated through the browser-based user interface, and hence it is convenient to present all aspects of this view together. Thus, the Web Portal provides the user facing ‘front’ of the system and interfaces to the services provided by the domain areas identified in the system design.</p>
</div>
<div class="paragraph">
<p>The Web Portal must provide a consistent and cohesive user experience that aggregates data and processing services of the EO Exploitation Platform. In doing so it must provide the following main functionalities:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>User login</p>
</li>
<li>
<p>Marketplace, that provides a federated system search for discovery of data and processing capabilities</p>
</li>
<li>
<p>User workspace to support scientific analysis and collaboration</p>
</li>
<li>
<p>Data discovery and download of data</p>
</li>
<li>
<p>In-browser visualisation of data and processing/analysis results</p>
</li>
<li>
<p>Discovery, execution and monitoring of processing jobs</p>
</li>
<li>
<p>Definition of workflows from discovered data/processing resources</p>
</li>
<li>
<p>Hosting of user defined applications with interactive user interfaces</p>
</li>
<li>
<p>Hosting of rich media content that is linked to catalogued resources. Such content ranges from documents &amp; manuals to tutorials and instructional media.</p>
</li>
<li>
<p>Hosting of community and collaboration tools such as Wikis, FAQs and forums</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These user-facing web components form part of other domain areas that together present a rich integrated user experience. <a href="#img_webPortal">Figure 26</a> presents these functional areas, organised within their respective domain areas.</p>
</div>
<div id="img_webPortal" class="imageblock text-center">
<div class="content">
<img src="./images/web-portal.png" alt="web portal" width="90%">
</div>
<div class="title">Figure 26. Web Portal: Overview</div>
</div>
<div class="paragraph">
<p>The platform should support provision of limited access to unauthenticated (guest) users, in which they can search the marketplace to discover the services and data available, and browse supporting materials. Access to the full capabilities of the platform requires registered users to identify and authenticate.</p>
</div>
<div class="paragraph">
<p>Optionally, a <strong>Content Management System (CMS)</strong> can provide a framework within which the platform’s web presence is hosted. It facilitates the creation of user content that can be linked to data and processing resources in the Resource Catalogue. In addition, the CMS provides out-of-the-box facilities for Wikis, FAQs, forums etc.</p>
</div>
<div class="paragraph">
<p>The <strong>Marketplace</strong> builds a user experience on top of the Application &amp; Data Catalogues that provides a consolidated inventory of all services, applications and data published within the federated system. The user is presented with the ability to browse and to perform rich search queries to discover items of specific interest. The Marketplace content for a data item can include interactive Data Visualisation, such as providing a WMS viewer that exploits the WMS service provided with the platform’s resource service. This <strong>Data Visualisation</strong> component is re-usable such that it can be used elsewhere in the user experience, for example from the user’s workspace to visualise some processing results.</p>
</div>
<div class="paragraph">
<p>The <strong>User Workspace</strong> provides the environment where users are able to organise data and processing they are interested in, and to manage asynchronous ‘tasks’ they have submitted into the platform. Thus, they are able to monitor data retrieval and processing requests and obtain the outputs at completion. The facility is also provided for them to publish derived ‘added-value’ outcomes from their workspace into the Resource Catalogue, and so present them in the marketplace.</p>
</div>
<div class="paragraph">
<p>Experts use the <strong>Workflow Composition</strong> interface to chain and combine multiple processing functions and input data into reusable workflows. The interface allows them to select these resources discovered via the Marketplace, architect and execute their workflow, and ultimately publish it as a reusable processing function that is available to others in the Marketplace.</p>
</div>
<div class="paragraph">
<p>Experts are provided with an <strong>Interactive Analysis Tool</strong> that presents a hosted coding environment through which they can interact directly with the data and services of the platform. Additionally, Experts are able to develop and submit to the EO Exploitation Platform their own custom processing algorithms, tools and applications. The <strong>Processor Development Environment</strong> provides a rich, interactive environment in which processing algorithms and services can be developed, tested, debugged and ultimately packaged so that they can be deployed to the platform and published via the marketplace.</p>
</div>
<div class="paragraph">
<p><strong>User Management</strong> provides the functionality associated with user profiles. New users will have the ability to self-register and then manage all aspects of their profile interactively - noting that the intention in the Common Architecture is to delegate User Identity management to external IdPs.</p>
</div>
<div class="paragraph">
<p><strong>Operators</strong> will have access to management interfaces for system monitoring and administration.</p>
</div>
<hr>
<div class="paragraph large">
<p>&lt;&lt; End of Document &gt;&gt;</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version Draft for 1.1<br>
Last updated 2020-03-19 12:48:08 UTC
</div>
</div>
<link rel="stylesheet" href="stylesheets/coderay-asciidoctor.css">
</body>
</html>